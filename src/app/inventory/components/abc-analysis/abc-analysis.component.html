<div class="abc-analysis">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading ABC analysis data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <svg class="w-12 h-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
    </svg>
    <h3 class="error-title">{{ error }}</h3>
    <button class="btn btn-primary" (click)="refreshData()">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
      </svg>
      Retry
    </button>
  </div>

  <!-- ABC Analysis Content -->
  <div *ngIf="!loading && !error">
    <!-- Header Section -->
    <div class="abc-header">
      <div class="header-left">
        <h2 class="main-title">ABC Analysis Report</h2>
        <p class="subtitle">Inventory classification by value contribution</p>
      </div>
      <div class="header-right">
        <button class="btn btn-secondary" (click)="refreshData()" title="Refresh Data">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
          Refresh
        </button>
        <button class="export-btn" (click)="exportCSV()">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          Export CSV
        </button>
      </div>
    </div>

    <!-- ABC Classification Summary Cards -->
    <div class="abc-summary-cards">
      <!-- Class A Items Card -->
      <div class="abc-card class-a">
        <div class="card-header">
          <div class="class-badge class-a-badge">A</div>
          <h3 class="card-title">Class A Items</h3>
        </div>
        <div class="card-metrics">
          <div class="metric-row">
            <span class="metric-label">Count:</span>
            <span class="metric-value">{{ abcData.classA.count }}</span>
          </div>
          <div class="metric-row">
            <span class="metric-label">Value:</span>
            <span class="metric-value">AED {{ abcData.classA.value.toLocaleString() }}</span>
          </div>
          <div class="metric-row">
            <span class="metric-label">Value %:</span>
            <span class="metric-value">{{ abcData.classA.percentage.toFixed(1) }}%</span>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill class-a-fill" [style.width.%]="abcData.classA.percentage"></div>
        </div>
      </div>

      <!-- Class B Items Card -->
      <div class="abc-card class-b">
        <div class="card-header">
          <div class="class-badge class-b-badge">B</div>
          <h3 class="card-title">Class B Items</h3>
        </div>
        <div class="card-metrics">
          <div class="metric-row">
            <span class="metric-label">Count:</span>
            <span class="metric-value">{{ abcData.classB.count }}</span>
          </div>
          <div class="metric-row">
            <span class="metric-label">Value:</span>
            <span class="metric-value">AED {{ abcData.classB.value.toLocaleString() }}</span>
          </div>
          <div class="metric-row">
            <span class="metric-label">Value %:</span>
            <span class="metric-value">{{ abcData.classB.percentage.toFixed(1) }}%</span>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill class-b-fill" [style.width.%]="abcData.classB.percentage"></div>
        </div>
      </div>

      <!-- Class C Items Card -->
      <div class="abc-card class-c">
        <div class="card-header">
          <div class="class-badge class-c-badge">C</div>
          <h3 class="card-title">Class C Items</h3>
        </div>
        <div class="card-metrics">
          <div class="metric-row">
            <span class="metric-label">Count:</span>
            <span class="metric-value">{{ abcData.classC.count }}</span>
          </div>
          <div class="metric-row">
            <span class="metric-label">Value:</span>
            <span class="metric-value">AED {{ abcData.classC.value.toLocaleString() }}</span>
          </div>
          <div class="metric-row">
            <span class="metric-label">Value %:</span>
            <span class="metric-value">{{ abcData.classC.percentage.toFixed(1) }}%</span>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill class-c-fill" [style.width.%]="abcData.classC.percentage"></div>
        </div>
      </div>
    </div>

    <!-- Detailed Analysis Section -->
    <div class="detailed-analysis">
      <h3 class="section-title">Detailed Analysis</h3>
      
      <!-- Search and Filter Controls -->
      <div class="controls-row">
        <div class="search-container">
          <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <input 
            type="text" 
            placeholder="Search parts..." 
            class="search-input"
            [value]="searchTerm"
            (input)="onSearchChange($event)">
        </div>

        <div class="filter-container">
          <select 
            class="filter-select"
            [value]="selectedClass"
            (change)="onClassFilterChange($event)">
            <option value="all">All Classes</option>
            <option value="A">Class A</option>
            <option value="B">Class B</option>
            <option value="C">Class C</option>
          </select>
          <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </div>
      </div>

      <!-- Analysis Table -->
      <div class="analysis-table-container">
        <table class="analysis-table">
          <thead>
            <tr>
              <th>Part Number</th>
              <th>Part Name</th>
              <th>Total Value</th>
              <th>Value %</th>
              <th>Cumulative %</th>
              <th>ABC Class</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of filteredItems">
              <td class="part-number">{{ item.part_id }}</td>
              <td class="part-name">{{ item.name }}</td>
              <td class="total-value">AED {{ item.value.toLocaleString() }}</td>
                             <td class="value-percentage">{{ calculateValuePercentage(item.value).toFixed(2) }}%</td>
              <td class="cumulative-percentage">{{ (item.cumulative_ratio * 100).toFixed(2) }}%</td>
              <td class="abc-class">
                <span class="abc-badge" [class]="getAbcClassColor(item.class)">
                  {{ item.class }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- No Results Message -->
        <div *ngIf="filteredItems.length === 0" class="no-results">
          <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          <h3 class="no-results-title">No Results Found</h3>
          <p class="no-results-description">Try adjusting your search criteria or filters.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Voice Assistant Button -->
  <button class="voice-assistant" (click)="refreshData()" title="Refresh Data">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
    </svg>
  </button>
</div>
