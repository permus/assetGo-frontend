<div class="dashboard-overview">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <svg class="w-12 h-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
    </svg>
    <h3 class="error-title">{{ error }}</h3>
    <button class="btn btn-primary" (click)="refreshData()">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
      </svg>
      Retry
    </button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && !error">
    <!-- Header with Refresh Button -->
    <div class="dashboard-header">
      <h2 class="dashboard-title">Inventory Overview</h2>
      <button class="btn btn-secondary" (click)="refreshData()" title="Refresh Data">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
        Refresh
      </button>
    </div>

    <!-- Top Row - Metric Cards -->
    <div class="metrics-row">
      <div class="metric-card">
        <div class="card-header">
          <h4 class="card-title">Total Inventory Value</h4>
          <div class="card-icon">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
            </svg>
          </div>
        </div>
        <div class="card-value">{{ getCurrencySymbol() }}{{ dashboardData.total_value | numberFormat:0 }}</div>
        <div class="card-trend positive">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
          </svg>
          Real-time data
        </div>
      </div>

      

      <div class="metric-card">
        <div class="card-header">
          <h4 class="card-title">Parts at Reorder Point</h4>
          <div class="card-icon warning">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
          </div>
        </div>
        <div class="card-value warning">{{ dashboardData.low_stock_count }}</div>
        <div class="card-message" *ngIf="dashboardData.low_stock_count > 0; else noLowStock">
          Need immediate attention
        </div>
        <ng-template #noLowStock>
          <div class="card-message">All items well stocked</div>
        </ng-template>
      </div>

      

      <!-- New: Average Turnover Card (from overview or turnoverData) -->
      <div class="metric-card" *ngIf="(dashboardData.average_turnover !== undefined) || turnoverData">
        <div class="card-header">
          <h4 class="card-title">Average Turnover</h4>
          <div class="card-icon">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3v4h4M21 21v-4h-4M3 17v4h4M21 7V3h-4"></path>
            </svg>
          </div>
        </div>
        <div class="card-value">{{ (dashboardData.average_turnover ?? turnoverData?.turnover ?? 0) | number:'1.1-2' }}x</div>
        <div class="card-message">Times per year</div>
      </div>

      <!-- New: Slow Moving Items Card (from overview or agingData) -->
      <div class="metric-card" *ngIf="(dashboardData.slow_moving_count !== undefined) || agingData">
        <div class="card-header">
          <h4 class="card-title">Slow Moving Items</h4>
          <div class="card-icon">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
          </div>
        </div>
        <div class="card-value">{{ dashboardData.slow_moving_count ?? (agingData?.slow_moving?.length || 0) }}</div>
        <div class="card-message">{{ slowThresholdDays }}+ days without movement</div>
      </div>
    </div>

    <!-- Middle Row - Classification Cards -->
    <div class="classification-row">
      <div class="classification-card">
        <h4 class="classification-title">Class A Items</h4>
        <div class="classification-stats">
          <div class="stat-item">
            <span class="stat-label">Count:</span>
            <span class="stat-value">{{ abcSummary.classA.count }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Value:</span>
            <span class="stat-value">{{ formatCurrency(abcSummary.classA.value) }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Percentage:</span>
            <span class="stat-value">{{ abcSummary.classA.percentage | numberFormat:1 }}%</span>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="abcSummary.classA.percentage"></div>
        </div>
      </div>

      <div class="classification-card">
        <h4 class="classification-title">Class B Items</h4>
        <div class="classification-stats">
          <div class="stat-item">
            <span class="stat-label">Count:</span>
            <span class="stat-value">{{ abcSummary.classB.count }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Value:</span>
            <span class="stat-value">{{ formatCurrency(abcSummary.classB.value) }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Percentage:</span>
            <span class="stat-value">{{ abcSummary.classB.percentage | numberFormat:1 }}%</span>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="abcSummary.classB.percentage"></div>
        </div>
      </div>

      <div class="classification-card">
        <h4 class="classification-title">Class C Items</h4>
        <div class="classification-stats">
          <div class="stat-item">
            <span class="stat-label">Count:</span>
            <span class="stat-value">{{ abcSummary.classC.count }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Value:</span>
            <span class="stat-value">{{ formatCurrency(abcSummary.classC.value) }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Percentage:</span>
            <span class="stat-value">{{ abcSummary.classC.percentage | numberFormat:1 }}%</span>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="abcSummary.classC.percentage"></div>
        </div>
      </div>
    </div>

    <!-- Bottom Section - Active Reorder Alerts -->
    <div class="alerts-section" *ngIf="dashboardData.low_stock_count > 0">
      <div class="alerts-header">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
        </svg>
        <h4 class="alerts-title">Active Reorder Alerts</h4>
      </div>
      
      <div class="alert-item">
        <div class="alert-left">
          <svg class="w-5 h-5 warning-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
          <div class="alert-content">
            <span class="alert-part">{{ dashboardData.low_stock_count }} parts</span>
            <span class="alert-details">Need reordering attention</span>
          </div>
        </div>
        <div class="alert-right">
          <span class="priority-tag high">high</span>
        </div>
      </div>
    </div>

    <!-- No Alerts Message -->
    <div class="no-alerts" *ngIf="dashboardData.low_stock_count === 0">
      <svg class="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <h3 class="no-alerts-title">All Good!</h3>
      <p class="no-alerts-description">No reorder alerts at this time. All inventory levels are healthy.</p>
    </div>
  </div>

  <!-- Floating Action Button -->
  <button class="fab" (click)="refreshData()" title="Refresh Dashboard">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
    </svg>
  </button>
</div>
