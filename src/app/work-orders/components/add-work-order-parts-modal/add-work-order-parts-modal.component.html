<div class="modal-overlay" *ngIf="isOpen" (click)="close()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Add Parts</h3>
      <button class="close" (click)="close()">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="search-row">
        <input class="form-input" [(ngModel)]="query" placeholder="Search parts by name or code" />
        <button class="btn btn-primary" (click)="search()" [disabled]="loading">Search</button>
      </div>
      <div class="results" *ngIf="results.length">
        <div class="result-row" *ngFor="let p of results">
          <div class="left">
            <div class="name">{{ p.name }}</div>
            <div class="sub">UoM: {{ $any(p).uom || '-' }} â€¢ On hand: {{ $any(p).on_hand || '-' }}</div>
          </div>
          <div class="right">
            <button 
              *ngIf="!isPartInCart(p.id)"
              class="btn" 
              (click)="addToCart(p)">
              Add
            </button>
            <button 
              *ngIf="isPartInCart(p.id)"
              class="btn" 
              disabled
              style="background-color: #10b981; color: white; cursor: not-allowed; opacity: 0.8;">
              <svg style="width: 16px; height: 16px; display: inline-block; margin-right: 4px; vertical-align: middle;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              Added
            </button>
          </div>
        </div>
      </div>

      <div class="cart" *ngIf="cart.length">
        <div class="cart-row" *ngFor="let c of cart">
          <div class="left">{{ c.part.name }}</div>
          <div class="right">
            <input class="qty" type="number" [(ngModel)]="c.qty" min="0.001" step="0.001" />
            <input class="cost" type="number" [(ngModel)]="c.unit_cost" min="0" step="0.01" placeholder="Unit cost" />
            <button class="icon" (click)="removeFromCart($any(c.part).id)">ðŸ—‘</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="close()">Cancel</button>
      <button class="btn btn-primary" (click)="save()" [disabled]="cart.length===0">Add to Work Order</button>
    </div>
  </div>
  </div>


