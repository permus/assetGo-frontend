<div class="min-h-screen bg-gray-50 flex">

  <!-- Sidebar -->
  <app-sidebar [sidebarOpen]="sidebarOpen"></app-sidebar>


  <div class="flex flex-col flex-1 transition-all duration-300 ease-in-out"
       [class.ml-64]="!isRtl() && sidebarOpen" [class.ml-16]="!isRtl() && !sidebarOpen"
       [class.mr-64]="isRtl() && sidebarOpen" [class.mr-16]="isRtl() && !sidebarOpen">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0" style="z-index: 100;">
      <div class="flex items-center justify-between px-6 py-4">
        <!-- Left side -->
        <div class="flex items-center space-x-4">
          <!-- Sidebar toggle -->
          <button class="p-2 rounded-lg hover:bg-gray-100 cursor-pointer" (click)="toggleSidebar()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" class="size-5 text-gray-600"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect width="18" height="18" x="3" y="3" rx="2"></rect>
              <path d="M9 3v18"></path>
            </svg>
          </button>


        </div>

        <!-- Right side -->
        <div class="flex items-center space-x-4 " [class.ml-auto]="!isRtl()" [class.ms-auto]="isRtl()">

          <!-- Notifications -->
          <app-notification-dropdown></app-notification-dropdown>

          <!-- User menu -->
          <div class="relative">
            <button
              (click)="toggleUserDropdown()"
              class="flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer">
              <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium overflow-hidden">
                <img
                  *ngIf="currentUser?.avatar_url"
                  [src]="currentUser.avatar_url"
                  [alt]="currentUser.first_name + ' ' + currentUser.last_name"
                  class="w-full h-full object-cover">
                <span *ngIf="!currentUser?.avatar_url">{{ getUserInitials() }}</span>
              </div>
              <div class="text-sm">
                <div class="font-medium text-gray-900">{{ currentUser?.first_name }} {{ currentUser?.last_name }}</div>
                <div class="text-gray-500">{{ currentUser?.user_type }} â€¢ {{ currentUser?.company?.name }}</div>
              </div>
              <svg class="w-4 h-4 text-gray-400 transition-transform" [class.rotate-180]="showUserDropdown" fill="none"
                   stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>

            <!-- User Dropdown Menu -->
            <div *ngIf="showUserDropdown"
                 class="absolute mt-2 w-80 bg-white rounded-xl shadow-lg border border-gray-200 py-2" [class.right-0]="!isRtl()" [class.left-0]="isRtl()"
                 style="z-index: 150;">
              <!-- User Info Header -->
              <div class="px-4 py-3 border-b border-gray-100">
                <div class="flex items-center space-x-3">
                  <div
                    class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium text-lg overflow-hidden">
                    <img
                      *ngIf="currentUser?.avatar_url"
                      [src]="currentUser.avatar_url"
                      [alt]="currentUser.first_name + ' ' + currentUser.last_name"
                      class="w-full h-full object-cover">
                    <span *ngIf="!currentUser?.avatar_url">{{ getUserInitials() }}</span>
                  </div>
                  <div>
                    <div class="font-semibold text-gray-900">{{ currentUser?.first_name }} {{ currentUser?.last_name }}
                    </div>
                    <div class="text-sm text-gray-500">{{ currentUser?.email }}</div>
                    <div class="text-xs text-gray-400 mt-1">{{ currentUser?.company?.name }}</div>
                  </div>
                </div>
              </div>

              <!-- Account Management -->
              <div class="px-4 py-2">
                <button
                  (click)="router.navigate(['/profile'])"
                  class="w-full flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-blue-50 text-left transition-colors cursor-pointer">
                  <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                    <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                  </div>
                  <div>
                    <div class="font-medium text-gray-900">Manage Account</div>
                    <div class="text-xs text-gray-500">Personal info, privacy, and more</div>
                  </div>
                </button>
              </div>


              <!-- Sign Out -->
              <div class="px-4 py-2 border-t border-gray-100">
                <button
                  (click)="signOut()"
                  class="w-full flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-red-50 text-left transition-colors cursor-pointer">
                  <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">
                    <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                  </div>
                  <div>
                    <div class="font-medium text-gray-900">Sign Out</div>
                    <div class="text-xs text-gray-500">Sign out of your account</div>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>
