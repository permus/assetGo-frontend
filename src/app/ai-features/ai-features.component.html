<div class="ai-features-container">
  <!-- Header Section -->
  <div class="header-section">
    <h1 class="main-title">AI-Powered Features</h1>
    <p class="main-description">Leverage artificial intelligence to optimize asset management and gain deeper insights.</p>
  </div>

  <!-- Tabs Navigation -->
  <div class="tabs-container">
    <div class="tabs-nav">
      <button 
        *ngFor="let tab of tabs" 
        [class.active]="activeTab === tab.id"
        (click)="setActiveTab(tab.id)"
        class="tab-button">
        <svg class="tab-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path [attr.d]="getTabIcon(tab.icon)"></path>
        </svg>
        <span class="tab-label">{{ tab.label }}</span>
      </button>
    </div>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Image Recognition Tab -->
    <div *ngIf="activeTab === 'image-recognition'" class="tab-panel">
      <div class="section-header">
        <h2 class="section-title">AI Image Recognition</h2>
        <p class="section-description">Upload asset images for automatic identification and condition assessment.</p>
      </div>

      <!-- AI Image Analyzer Component -->
      <div class="ai-assistant-card">
        <div class="ai-gradient-bg"></div>
        <div class="card-body">
          <h5>EquiAI Assistant</h5>
          <app-ai-image-analyzer
            (analysisComplete)="onAIAnalysisComplete($event)"
            (fieldUpdate)="onAIFieldUpdate($event)"
            (imageUploaded)="onImageUploaded($event)">
          </app-ai-image-analyzer>
        </div>
      </div>

      <!-- Asset Image Upload Section -->
      <div class="upload-section">
        <div class="upload-header">
          <div class="upload-title">
            <svg class="upload-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2C13.1 2 14 2.9 14 4V6H16C17.1 6 18 6.9 18 8V20C18 21.1 17.1 22 16 22H8C6.9 22 6 21.1 6 20V8C6 6.9 6.9 6 8 6H10V4C10 2.9 10.9 2 12 2M12 4V6H12V4M12 8C10.9 8 10 8.9 10 10S10.9 12 12 12S14 11.1 14 10S13.1 8 12 8M12 14C10.9 14 10 14.9 10 16S10.9 18 12 18S14 17.1 14 16S13.1 14 12 14Z"></path>
            </svg>
            <h3>Asset Image Upload</h3>
          </div>
          <div class="upload-actions">
            <button class="btn-secondary" (click)="triggerFileInput()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V15M17 8L12 3M12 3L7 8M12 3V15"></path>
              </svg>
              Upload Images
            </button>
            <button class="btn-primary" (click)="analyzeImages()" [disabled]="!selectedFiles.length || isAnalyzing">
              <svg *ngIf="!isAnalyzing" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V15M17 8L12 3M12 3L7 8M12 3V15"></path>
              </svg>
              <svg *ngIf="isAnalyzing" class="animate-spin" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12a9 9 0 11-6.219-8.56"></path>
              </svg>
              {{ isAnalyzing ? 'Analyzing...' : 'Analyze Image' }}
            </button>
          </div>
        </div>
        
        <p class="upload-description">Upload a high-quality, well-lit image of your asset (PNG, JPG, or JPEG up to 10MB) for optimal AI identification. Include clear views of nameplates and overall equipment for best results.</p>
        
          <!-- Upload Area -->
          <div class="upload-area" (click)="triggerFileInput()" (dragover)="onDragOver($event)" (drop)="onDrop($event)">
            <!-- Single Image Preview -->
            <div class="single-image-preview" *ngIf="selectedFiles.length > 0">
              <div class="preview-item">
                <img [src]="getFilePreview(selectedFiles[0])" [alt]="selectedFiles[0].name" class="preview-image">
                <div class="preview-overlay">
                  <button class="remove-preview" (click)="removeFile(0)" title="Remove image">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 6L6 18M6 6L18 18"></path>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Upload Placeholder (when no files) -->
            <div class="upload-placeholder" *ngIf="selectedFiles.length === 0">
              <svg class="upload-placeholder-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 2C13.1 2 14 2.9 14 4V6H16C17.1 6 18 6.9 18 8V20C18 21.1 17.1 22 16 22H8C6.9 22 6 21.1 6 20V8C6 6.9 6.9 6 8 6H10V4C10 2.9 10.9 2 12 2M12 4V6H12V4M12 8C10.9 8 10 8.9 10 10S10.9 12 12 12S14 11.1 14 10S13.1 8 12 8M12 14C10.9 14 10 14.9 10 16S10.9 18 12 18S14 17.1 14 16S13.1 14 12 14Z"></path>
              </svg>
              <p class="upload-text">Upload asset image</p>
              <p class="upload-hint">Click to browse or drag and drop file here</p>
            </div>
            <input #fileInput type="file" accept="image/png,image/jpeg,image/jpg" (change)="onFileSelected($event)" style="display: none;">
          </div>

        <!-- Selected Files Preview -->
        <div class="selected-files" *ngIf="selectedFiles.length > 0">
          <h4>Selected Files ({{ selectedFiles.length }})</h4>
          <div class="file-list">
            <div class="file-item" *ngFor="let file of selectedFiles; let i = index">
              <div class="file-info">
                <span class="file-name">{{ file.name }}</span>
                <span class="file-size">({{ formatFileSize(file.size) }})</span>
              </div>
              <button class="remove-file" (click)="removeFile(i)">×</button>
            </div>
          </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" *ngIf="isAnalyzing">
          <div class="loading-content">
            <div class="loading-spinner">
              <svg class="animate-spin" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12a9 9 0 11-6.219-8.56"></path>
              </svg>
            </div>
            <h3>Analyzing Image...</h3>
            <p>Our AI is examining your asset image to identify its type, condition, and provide recommendations.</p>
          </div>
        </div>

        <!-- Error Message -->
        <div class="error-message" *ngIf="errorMessage">
          <p>{{ errorMessage }}</p>
        </div>

        <!-- Recognition Results -->
        <div class="recognition-results" *ngIf="analysisResult">
          <div class="results-header">
            <div class="results-title">
              <svg class="success-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <h3>Recognition Results</h3>
            </div>
          </div>

          <div class="results-content">
            <!-- Key Information -->
            <div class="key-info">
              <div class="info-item">
                <span class="info-label">Asset Type</span>
                <span class="info-value">{{ analysisResult.assetType }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Confidence</span>
                <span class="info-value">
                  {{ analysisResult.confidence }}%
                  <span class="confidence-badge" [ngClass]="getConfidenceClass(analysisResult.confidence)">
                    {{ getConfidenceLabel(analysisResult.confidence) }}
                  </span>
                </span>
              </div>
              <div class="info-item" *ngIf="analysisResult.manufacturer">
                <span class="info-label">Manufacturer</span>
                <span class="info-value">{{ analysisResult.manufacturer }}</span>
              </div>
            </div>

            <!-- Condition Assessment -->
            <div class="condition-section">
              <h4>Condition Assessment</h4>
              <div class="condition-badge" [ngClass]="getConditionClass(analysisResult.condition)">
                {{ analysisResult.condition }}
              </div>
              <p class="condition-description">
                Based on visual inspection, the asset appears to be in {{ analysisResult.condition.toLowerCase() }} condition.
              </p>
            </div>

            <!-- AI Recommendations -->
            <div class="recommendations-section" *ngIf="analysisResult.recommendations?.length">
              <h4>
                <svg class="recommendations-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                  <line x1="12" y1="9" x2="12" y2="13"></line>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                AI Recommendations
              </h4>
              <ul class="recommendations-list">
                <li *ngFor="let rec of analysisResult.recommendations">
                  <svg class="check-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  {{ rec }}
                </li>
              </ul>
            </div>

            <!-- Feedback Section -->
            <div class="feedback-section" *ngIf="!feedbackSubmitted">
              <h4>
                <svg class="feedback-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                Help Improve AI Recognition
              </h4>
              <p class="feedback-description">Was this recognition accurate? Your feedback helps improve our AI.</p>
              
              <div class="feedback-buttons">
                <button 
                  class="feedback-btn accurate" 
                  [class.selected]="feedbackType === 'accurate'"
                  (click)="selectFeedback('accurate')">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                  </svg>
                  Accurate
                </button>
                <button 
                  class="feedback-btn needs-correction" 
                  [class.selected]="feedbackType === 'needs_correction'"
                  (click)="selectFeedback('needs_correction')">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path>
                  </svg>
                  Needs Correction
                </button>
              </div>

              <!-- Correction Input -->
              <div class="correction-input" *ngIf="feedbackType === 'needs_correction'">
                <h5>Provide Corrections</h5>
                
                <!-- Correction Rows -->
                <div class="correction-rows">
                  <div class="correction-row" *ngFor="let correction of corrections; let i = index">
                    <div class="correction-fields">
                      <div class="field-input">
                        <label>Field (e.g., Asset Type)</label>
                        <input 
                          type="text" 
                          [(ngModel)]="correction.field"
                          placeholder="e.g., Asset Type, Manufacturer, Model"
                          class="field-name-input">
                      </div>
                      <div class="value-input">
                        <label>Correct value</label>
                        <input 
                          type="text" 
                          [(ngModel)]="correction.value"
                          placeholder="Enter correct value"
                          class="correct-value-input">
                      </div>
                    </div>
                    <button class="remove-correction" (click)="removeCorrection(i)" title="Remove correction">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6L18 18"></path>
                      </svg>
                    </button>
                  </div>
                </div>

                <!-- Add Correction Button -->
                <button class="add-correction-btn" (click)="addCorrection()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"></path>
                  </svg>
                  Add Correction
                </button>

                <!-- Action Buttons -->
                <div class="correction-actions">
                  <button class="btn-secondary" (click)="cancelFeedback()">Cancel</button>
                  <button 
                    class="btn-primary" 
                    (click)="submitFeedback()"
                    [disabled]="isSubmittingFeedback || corrections.length === 0">
                    {{ isSubmittingFeedback ? 'Submitting...' : 'Submit Feedback' }}
                  </button>
                </div>
              </div>

              <!-- Submit Feedback for Accurate -->
              <div class="feedback-actions" *ngIf="feedbackType === 'accurate'">
                <button 
                  class="btn-primary" 
                  (click)="submitFeedback()"
                  [disabled]="isSubmittingFeedback">
                  {{ isSubmittingFeedback ? 'Submitting...' : 'Submit Feedback' }}
                </button>
              </div>
            </div>

            <!-- Feedback Submitted -->
            <div class="feedback-success" *ngIf="feedbackSubmitted">
              <svg class="success-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <h4>Thank you for your feedback!</h4>
              <p>Your input helps us improve our AI recognition accuracy.</p>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
              <button class="btn-primary" (click)="openCreateAssetModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14,2 14,8 20,8"></polyline>
                  <line x1="16" y1="13" x2="8" y2="13"></line>
                  <line x1="16" y1="17" x2="8" y2="17"></line>
                  <polyline points="10,9 9,9 8,9"></polyline>
                </svg>
                Create Asset Record
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Example Supported Assets Section -->
      <div class="examples-section">
        <h3 class="examples-title">Example Supported Assets</h3>
        <p class="examples-description">Our AI can recognize and analyze various types of equipment.</p>
        
        <div class="asset-types-grid">
          <div class="asset-type-card" *ngFor="let assetType of assetTypes">
            <div class="asset-type-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path [attr.d]="getAssetTypeIcon(assetType.icon)"></path>
              </svg>
            </div>
            <span class="asset-type-name">{{ assetType.name }}</span>
          </div>
        </div>
        </div>

      </div>

      <!-- Other Tabs (Placeholder) -->
    <div *ngIf="activeTab === 'predictive-maintenance'" class="tab-panel">
      <div class="coming-soon">
        <h2>Predictive Maintenance</h2>
        <p>This feature is coming soon. Stay tuned for AI-powered predictive maintenance capabilities.</p>
      </div>
    </div>

    <div *ngIf="activeTab === 'natural-language'" class="tab-panel">
      <div class="coming-soon">
        <h2>Natural Language Processing</h2>
        <p>This feature is coming soon. Interact with your asset data using natural language queries.</p>
      </div>
    </div>

    <div *ngIf="activeTab === 'recommendations'" class="tab-panel">
      <div class="coming-soon">
        <h2>AI Recommendations</h2>
        <p>This feature is coming soon. Get intelligent recommendations for asset optimization.</p>
      </div>
    </div>

    <div *ngIf="activeTab === 'ai-analytics'" class="tab-panel">
      <div class="section-header">
        <h2 class="section-title">AI Asset Analytics</h2>
        <p class="section-description">Get comprehensive insights into your asset portfolio with AI-powered analysis.</p>
      </div>

      <!-- Asset Selection Section -->
      <div class="analytics-section">
        <div class="section-header">
          <h3>Asset Portfolio</h3>
          <div class="section-actions">
            <button class="btn-secondary" (click)="addSampleAssets()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14"></path>
              </svg>
              Add Sample Assets
            </button>
            <button class="btn-secondary" (click)="clearSelectedAssets()" [disabled]="selectedAssets.length === 0">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
              </svg>
              Clear All
            </button>
          </div>
        </div>

        <!-- Selected Assets List -->
        <div class="selected-assets" *ngIf="selectedAssets.length > 0">
          <div class="asset-card" *ngFor="let asset of selectedAssets">
            <div class="asset-info">
              <h4>{{ asset.name }}</h4>
              <p class="asset-details">{{ asset.type }} • {{ asset.manufacturer }} {{ asset.model }}</p>
              <p class="asset-meta">Age: {{ asset.age }} years • Condition: {{ asset.condition }} • Value: ${{ asset.value | number }}</p>
            </div>
            <div class="asset-status">
              <span class="status-badge" [ngClass]="asset.condition.toLowerCase()">{{ asset.condition }}</span>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="selectedAssets.length === 0">
          <svg class="empty-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <h3>No Assets Selected</h3>
          <p>Add assets to your portfolio to get AI-powered analytics and insights.</p>
        </div>

        <!-- Image Upload Section -->
        <div class="image-upload-section" *ngIf="selectedAssets.length > 0">
          <h4>Asset Images (Optional)</h4>
          <p class="section-description">Upload images of your assets for enhanced analysis. Maximum 5 images.</p>
          
          <div class="image-upload-area">
            <input
              type="file"
              #analyticsFileInput
              (change)="onAnalyticsFileSelected($event)"
              accept="image/*"
              multiple
              [disabled]="analyticsImages.length >= 5"
              class="file-input">
            
            <div class="upload-prompt" (click)="analyticsFileInput.click()">
              <svg class="upload-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17,8 12,3 7,8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              <p>Click to upload images or drag and drop</p>
              <span class="upload-limit">{{ analyticsImages.length }}/5 images</span>
            </div>
          </div>

          <!-- Image Previews -->
          <div class="image-previews" *ngIf="analyticsImages.length > 0">
            <div class="preview-item" *ngFor="let image of analyticsImages; let i = index">
              <img [src]="image" [alt]="'Asset image ' + (i + 1)">
              <button class="remove-image" (click)="removeAnalyticsImage(i)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 6L6 18M6 6L18 18"></path>
                </svg>
              </button>
            </div>
          </div>

          <div class="image-actions" *ngIf="analyticsImages.length > 0">
            <button class="btn-secondary" (click)="clearAnalyticsImages()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
              </svg>
              Clear All Images
            </button>
          </div>
        </div>

        <!-- Analysis Button -->
        <div class="analysis-actions" *ngIf="selectedAssets.length > 0">
          <button 
            class="btn-primary" 
            (click)="analyzeAssets()" 
            [disabled]="isAnalyzingAssets">
            <svg *ngIf="!isAnalyzingAssets" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 19c-5 0-7-2-7-5V6c0-3 2-5 7-5s7 2 7 5v8c0 3-2 5-7 5zM15 13l3 3-3 3"></path>
            </svg>
            <svg *ngIf="isAnalyzingAssets" class="animate-spin" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12a9 9 0 11-6.219-8.56"></path>
            </svg>
            {{ isAnalyzingAssets ? 'Analyzing...' : 'Analyze Portfolio' }}
          </button>
        </div>
      </div>

      <!-- Analytics Results -->
      <div class="analytics-results" *ngIf="analyticsResult">
        <div class="results-header">
          <h3>Analytics Results</h3>
        </div>

        <!-- Health Score -->
        <div class="health-score-section">
          <h4>Overall Health Score</h4>
          <div class="health-score-display">
            <div class="score-circle" [ngClass]="getHealthScoreClass(analyticsResult.healthScore)">
              <span class="score-value">{{ analyticsResult.healthScore }}</span>
              <span class="score-label">/ 100</span>
            </div>
            <div class="score-description">
              <p>Portfolio Health Assessment</p>
              <span class="score-status" [ngClass]="getHealthScoreClass(analyticsResult.healthScore)">
                {{ analyticsResult.healthScore >= 80 ? 'Excellent' : analyticsResult.healthScore >= 60 ? 'Good' : analyticsResult.healthScore >= 40 ? 'Fair' : 'Poor' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Risk Assets -->
        <div class="risk-assets-section" *ngIf="analyticsResult.riskAssets.length > 0">
          <h4>High-Risk Assets</h4>
          <div class="risk-assets-list">
            <div class="risk-asset-card" *ngFor="let asset of analyticsResult.riskAssets">
              <div class="risk-info">
                <h5>{{ asset.name }}</h5>
                <p class="risk-reason">{{ asset.reason }}</p>
              </div>
              <div class="risk-meta">
                <span class="risk-level" [ngClass]="getRiskLevelClass(asset.riskLevel)">{{ asset.riskLevel }}</span>
                <span class="confidence">{{ asset.confidence }}% confidence</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Performance Insights -->
        <div class="insights-section" *ngIf="analyticsResult.insights.length > 0">
          <h4>Performance Insights</h4>
          <div class="insights-list">
            <div class="insight-card" *ngFor="let insight of analyticsResult.insights">
              <div class="insight-header">
                <h5>{{ insight.title }}</h5>
                <span class="impact-badge" [ngClass]="getImpactClass(insight.impact)">{{ insight.impact }}</span>
              </div>
              <p class="insight-description">{{ insight.description }}</p>
              <div class="insight-action">
                <strong>Action:</strong> {{ insight.action }}
              </div>
            </div>
          </div>
        </div>

        <!-- Cost Optimizations -->
        <div class="optimizations-section" *ngIf="analyticsResult.optimizations.length > 0">
          <h4>Cost Optimization Opportunities</h4>
          <div class="optimizations-list">
            <div class="optimization-card" *ngFor="let opt of analyticsResult.optimizations">
              <div class="optimization-header">
                <h5>{{ opt.title }}</h5>
                <div class="savings-info">
                  <span class="savings-amount">AED {{ opt.estimatedSavings | number }}</span>
                  <span class="payback-period">{{ opt.paybackPeriod }} payback</span>
                </div>
              </div>
              <p class="optimization-description">{{ opt.description }}</p>
              <div class="optimization-confidence">
                <span class="confidence-label">Confidence:</span>
                <span class="confidence-value">{{ opt.confidence }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div class="error-message" *ngIf="errorMessage">
        <p>{{ errorMessage }}</p>
      </div>
    </div>

    <!-- Analytics Loading Overlay -->
    <div class="loading-overlay" *ngIf="isAnalyzingAssets">
      <div class="loading-content">
        <div class="loading-spinner">
          <svg class="animate-spin" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 11-6.219-8.56"></path>
          </svg>
        </div>
        <h3>Analyzing Portfolio...</h3>
        <p>Our AI is analyzing your asset portfolio to provide comprehensive insights and recommendations.</p>
      </div>
    </div>
  </div>

  <!-- Create Asset Record Modal -->
  <div class="create-asset-modal" *ngIf="showCreateAssetModal">
    <div class="modal-overlay" (click)="closeCreateAssetModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">
          <svg class="modal-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14,2 14,8 20,8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10,9 9,9 8,9"></polyline>
          </svg>
          <h2>Create Asset Record</h2>
        </div>
        <button class="close-modal" (click)="closeCreateAssetModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6L18 18"></path>
          </svg>
        </button>
      </div>
      
      <div class="modal-body">
        <p class="modal-subtitle">Complete the asset details based on AI recognition</p>
        
        <form class="asset-form">
          <div class="form-row">
            <div class="form-column">
              <div class="form-group">
                <label for="assetName">Asset Name</label>
                <input 
                  type="text" 
                  id="assetName"
                  [(ngModel)]="assetForm.name" 
                  name="assetName"
                  class="form-input"
                  placeholder="Enter asset name">
              </div>
              
              <div class="form-group">
                <label for="model">Model</label>
                <input 
                  type="text" 
                  id="model"
                  [(ngModel)]="assetForm.model" 
                  name="model"
                  class="form-input"
                  placeholder="Enter model">
              </div>
              
              <div class="form-group">
                <label for="description">Description</label>
                <textarea 
                  id="description"
                  [(ngModel)]="assetForm.description" 
                  name="description"
                  class="form-textarea"
                  rows="3"
                  placeholder="Enter description"></textarea>
              </div>
            </div>
            
            <div class="form-column">
              <div class="form-group">
                <label for="manufacturer">Manufacturer</label>
                <input 
                  type="text" 
                  id="manufacturer"
                  [(ngModel)]="assetForm.manufacturer" 
                  name="manufacturer"
                  class="form-input"
                  placeholder="Enter manufacturer">
              </div>
              
              <div class="form-group">
                <label for="serialNumber">Serial Number</label>
                <input 
                  type="text" 
                  id="serialNumber"
                  [(ngModel)]="assetForm.serialNumber" 
                  name="serialNumber"
                  class="form-input"
                  placeholder="Enter serial number">
              </div>
            </div>
          </div>
          
          <div class="form-group full-width">
            <label for="location">Location</label>
            <div class="location-select">
              <svg class="location-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              <select 
                id="location"
                [(ngModel)]="assetForm.location" 
                name="location"
                class="form-select"
                [disabled]="loadingLocations">
                <option value="">{{ loadingLocations ? 'Loading locations...' : 'No location assigned' }}</option>
                <option *ngFor="let location of locations" [value]="location.id">
                  {{ location.name }}
                </option>
              </select>
              <svg *ngIf="!loadingLocations" class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6,9 12,15 18,9"></polyline>
              </svg>
              <svg *ngIf="loadingLocations" class="animate-spin loading-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12a9 9 0 11-6.219-8.56"></path>
              </svg>
            </div>
          </div>
        </form>
      </div>
      
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeCreateAssetModal()" [disabled]="isCreatingAsset">
          Cancel
        </button>
        <button 
          class="btn-primary" 
          (click)="createAsset()"
          [disabled]="isCreatingAsset || !assetForm.name.trim()">
          <svg *ngIf="!isCreatingAsset" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <svg *ngIf="isCreatingAsset" class="animate-spin" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 11-6.219-8.56"></path>
          </svg>
          {{ isCreatingAsset ? 'Creating...' : 'Create Asset' }}
        </button>
      </div>
    </div>
  </div>
</div>
