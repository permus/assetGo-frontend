import{a as V}from"./chunk-TABBCLNC.js";import{b as z}from"./chunk-FEFR2HO6.js";import"./chunk-BACLOCGF.js";import"./chunk-AS2LAICM.js";import{B as N,c as F,e as L,i as B}from"./chunk-BBYRNPLF.js";import"./chunk-MEXLA3FU.js";import{k as D,l as T,s as A,x as j}from"./chunk-CNTUU5WV.js";import{Bc as H,Gb as e,Hb as t,Ib as s,Pb as m,Qb as x,T as y,Ya as a,bb as P,bc as r,ca as b,cc as v,dc as u,ec as O,f as C,gc as k,hc as S,ic as w,kb as M,la as c,ma as d,pb as h,qc as E,sc as I,wb as p,yb as f}from"./chunk-RHVXZUNF.js";import"./chunk-EQDQRRRY.js";function $(l,i){l&1&&(e(0,"div",36),r(1,"Loading..."),t())}function W(l,i){l&1&&(e(0,"div",37)(1,"div",38),c(),e(2,"svg",39),s(3,"path",40)(4,"path",41)(5,"path",42),t()(),d(),e(6,"div",43),r(7,"No maintenance history found"),t(),e(8,"div",44),r(9,"Maintenance activities will appear here as they are completed."),t()())}function Z(l,i){if(l&1&&(e(0,"div",48)(1,"div",49)(2,"div")(3,"div",50),r(4),t(),e(5,"div",51),r(6),E(7,"date"),t()(),e(8,"div",52),r(9),t()()()),l&2){let o=i.$implicit;a(4),O("Plan #",o.maintenance_plan_id," ",o.plan_name,""),a(2),u("Completed \u2022 ",I(7,4,o.updated_at,"medium"),""),a(3),u("Priority: ",o.priority.name||o.priority_id||"-","")}}function U(l,i){if(l&1&&(e(0,"div",45)(1,"div",46),h(2,Z,10,7,"div",47),t()()),l&2){let o=x();a(2),p("ngForOf",o.filtered)}}var G=class l{constructor(i){this.api=i}loading=!1;error=null;all=[];filtered=[];search="";filter="all";stats={totalActivities:0,preventive:0,preventivePercentage:0,totalCost:0,avgDuration:0};destroy$=new C;currencyService=b(z);cdr=b(H);currentCurrency="USD";ngOnInit(){this.currencyService.get$().pipe(y(this.destroy$)).subscribe(i=>{this.currentCurrency=i,this.cdr.markForCheck()}),this.fetch(),this.fetchStats()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}fetch(){this.loading=!0,this.api.listSchedules({status:"completed",per_page:100}).subscribe({next:i=>{let o=Array.isArray(i?.data)?i.data:Array.isArray(i?.data?.schedules)?i.data.schedules:[];this.all=o.filter(n=>n.status==="completed"),this.apply(),this.loading=!1},error:()=>{this.loading=!1,this.error="Failed to load history"}})}fetchStats(){this.api.getHistoryStats().subscribe({next:i=>{i?.success&&i?.data&&(this.stats={totalActivities:i.data.totalActivities||0,preventive:i.data.preventive||0,preventivePercentage:i.data.preventivePercentage||0,totalCost:i.data.totalCost||0,avgDuration:i.data.avgDuration||0})},error:()=>{}})}formatCurrency(i){return this.currencyService.format(i)}formatDuration(i){return`${i.toFixed(1)}h`}apply(){let i=this.search?this.all.filter(o=>String(o.maintenance_plan_id).includes(this.search)):this.all;this.filtered=this.filter==="all"?i:i.filter(o=>(o.plan_type||"preventive")===this.filter)}static \u0275fac=function(o){return new(o||l)(P(V))};static \u0275cmp=M({type:l,selectors:[["app-history-page"]],decls:72,vars:17,consts:[[1,"min-h-screen","bg-gray-50","text-gray-900","p-6"],[1,"text-xl","font-semibold","mb-2"],[1,"text-sm","text-gray-500","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","mb-4","metrics-grid"],[1,"metric-card","info"],[1,"metric-header"],[1,"title"],[1,"badge"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5"],["stroke-linecap","round","stroke-linejoin","round","d","M21.75 6.75a4.5 4.5 0 0 1-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 1 1-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 0 1 6.336-4.486l-3.276 3.276a3.004 3.004 0 0 0 2.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852Z"],["stroke-linecap","round","stroke-linejoin","round","d","M4.867 19.125h.008v.008h-.008v-.008Z"],[1,"value"],[1,"hint"],["href","javascript:void(0)",1,"link"],[1,"metric-card","success"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","d","M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"],[1,"hint","text-green-600"],[1,"metric-card","warning"],["stroke-linecap","round","stroke-linejoin","round","d","M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"],[1,"hint","text-orange-600"],[1,"metric-card","danger"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"size-5","text-red-600"],["x1","10","x2","14","y1","2","y2","2"],["x1","12","x2","15","y1","14","y2","11"],["cx","12","cy","14","r","8"],[1,"hint","text-red-600"],[1,"search-row","mb-4"],[1,"form-row"],[1,"form-group"],["type","text","placeholder","Search by plan, status...",1,"w-full","pl-10","pr-4","py-2","border-2","transition-all","duration-300","ease-in-out","border-blue-300","rounded-xl","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","placeholder-gray-400",3,"ngModelChange","input","ngModel"],[1,"pill-group"],[1,"pill",3,"click"],["class","text-center py-20",4,"ngIf"],["class","text-center py-20 text-gray-500 bg-white border border-gray-200 rounded-xl",4,"ngIf"],["class","bg-white border border-gray-200 rounded-xl",4,"ngIf"],[1,"text-center","py-20"],[1,"text-center","py-20","text-gray-500","bg-white","border","border-gray-200","rounded-xl"],[1,"mb-4","flex","items-center","justify-center"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"size-10"],["d","M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"],["d","M3 3v5h5"],["d","M12 7v5l4 2"],[1,"text-lg","font-medium"],[1,"text-sm","text-gray-500"],[1,"bg-white","border","border-gray-200","rounded-xl"],[1,"divide-y","divide-gray-200"],["class","px-6 py-4",4,"ngFor","ngForOf"],[1,"px-6","py-4"],[1,"flex","items-center","justify-between"],[1,"font-medium","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"text-sm","text-gray-700"]],template:function(o,n){o&1&&(e(0,"div",0)(1,"h1",1),r(2,"Maintenance History"),t(),e(3,"p",2),r(4,"Track completed maintenance activities and their outcomes"),t(),e(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6),r(9,"Total Activities"),t(),e(10,"div",7),c(),e(11,"svg",8),s(12,"path",9)(13,"path",10),t()()(),d(),e(14,"div",11),r(15),t(),e(16,"div",12)(17,"a",13),r(18,"Items completed"),t()()(),e(19,"div",14)(20,"div",5)(21,"div",6),r(22,"Preventive"),t(),e(23,"div",7),c(),e(24,"svg",15),s(25,"path",16),t()()(),d(),e(26,"div",11),r(27),t(),e(28,"div",17),r(29),t()(),e(30,"div",18)(31,"div",5)(32,"div",6),r(33,"Total Cost"),t(),e(34,"div",7),c(),e(35,"svg",8),s(36,"path",19),t()()(),d(),e(37,"div",11),r(38),t(),e(39,"div",20),r(40,"Year to date"),t()(),e(41,"div",21)(42,"div",5)(43,"div",6),r(44,"Avg Duration"),t(),e(45,"div",7),c(),e(46,"svg",22),s(47,"line",23)(48,"line",24)(49,"circle",25),t()()(),d(),e(50,"div",11),r(51),t(),e(52,"div",26),r(53,"Per activity"),t()()(),e(54,"div",27)(55,"div",28)(56,"div",29)(57,"label"),r(58,"Search maintenance history"),t(),e(59,"input",30),w("ngModelChange",function(_){return S(n.search,_)||(n.search=_),_}),m("input",function(){return n.apply()}),t()()(),e(60,"div",31)(61,"button",32),m("click",function(){return n.filter="all",n.apply()}),r(62,"All"),t(),e(63,"button",32),m("click",function(){return n.filter="preventive",n.apply()}),r(64,"Preventive "),t(),e(65,"button",32),m("click",function(){return n.filter="predictive",n.apply()}),r(66,"Predictive "),t(),e(67,"button",32),m("click",function(){return n.filter="condition_based",n.apply()}),r(68,"Condition Based "),t()()(),h(69,$,2,0,"div",33)(70,W,10,0,"div",34)(71,U,3,1,"div",35),t()),o&2&&(a(15),v(n.stats.totalActivities),a(12),v(n.stats.preventive),a(2),u("",n.stats.preventivePercentage,"% of total"),a(9),v(n.formatCurrency(n.stats.totalCost)),a(13),v(n.formatDuration(n.stats.avgDuration)),a(8),k("ngModel",n.search),a(2),f("active",n.filter==="all"),a(2),f("active",n.filter==="preventive"),a(2),f("active",n.filter==="predictive"),a(2),f("active",n.filter==="condition_based"),a(2),p("ngIf",n.loading),a(),p("ngIf",!n.loading&&n.filtered.length===0),a(),p("ngIf",!n.loading&&n.filtered.length>0))},dependencies:[j,D,T,A,N,F,L,B],styles:[".card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;padding:1rem}.dark[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{background:#1f2937;border-color:#374151}.label[_ngcontent-%COMP%]{font-size:.75rem;color:#6b7280}.dark[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#9ca3af}.sublabel[_ngcontent-%COMP%]{font-size:.7rem;color:#9ca3af}.dark[_ngcontent-%COMP%]   .sublabel[_ngcontent-%COMP%]{color:#6b7280}.value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#111827}.dark[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#f3f4f6}.form-row[_ngcontent-%COMP%]{width:100%}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.25rem;font-size:.875rem;font-weight:500;color:#374151}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:24rem;max-width:100%;padding:.6rem .9rem;border:1px solid #d1d5db;border-radius:.5rem;min-height:42px;font-size:.875rem;background:#fff}.form-group[_ngcontent-%COMP%]   .field-error[_ngcontent-%COMP%]{color:#dc2626;font-size:.75rem;margin-top:.25rem}.metrics-grid[_ngcontent-%COMP%]{align-items:stretch}.metric-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:1rem;box-shadow:0 1px 2px #0000000a}.metric-card[_ngcontent-%COMP%]   .metric-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:.5rem}.metric-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:600;color:#111827}.dark[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#f3f4f6}.metric-card[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#e5f0ff;color:#2563eb;border-radius:10px;padding:.35rem .5rem;font-size:.75rem}.dark[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#1e3a8a;color:#93c5fd}.metric-card.info[_ngcontent-%COMP%]{background:#f2f8ff;border-color:#dbeafe}.dark[_ngcontent-%COMP%]   .metric-card.info[_ngcontent-%COMP%]{background:#1e3a8a20;border-color:#1e40af}.metric-card.success[_ngcontent-%COMP%]{background:#f2fffa;border-color:#d1fae5}.dark[_ngcontent-%COMP%]   .metric-card.success[_ngcontent-%COMP%]{background:#064e3b20;border-color:#065f46}.metric-card.warning[_ngcontent-%COMP%]{background:#fff8ed;border-color:#fde68a}.dark[_ngcontent-%COMP%]   .metric-card.warning[_ngcontent-%COMP%]{background:#78350f20;border-color:#92400e}.metric-card.danger[_ngcontent-%COMP%]{background:#fff5f5;border-color:#fecaca}.dark[_ngcontent-%COMP%]   .metric-card.danger[_ngcontent-%COMP%]{background:#7f1d1d20;border-color:#991b1b}.metric-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:#0f172a}.dark[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#f3f4f6}.metric-card[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-top:.5rem;font-size:.875rem;color:#6b7280}.dark[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{color:#9ca3af}.metric-card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none}.dark[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{color:#60a5fa}.search-row[_ngcontent-%COMP%]{display:flex;align-items:flex-end;justify-content:space-between;gap:1rem}.pill-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}.pill[_ngcontent-%COMP%]{white-space:nowrap;padding:.5rem .9rem;border:1px solid #d1d5db;border-radius:.5rem;background:#fff;color:#111827;font-size:.875rem}.dark[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]{background:#1f2937;border-color:#374151;color:#f3f4f6}.pill.active[_ngcontent-%COMP%], .dark[_ngcontent-%COMP%]   .pill.active[_ngcontent-%COMP%]{background:#2563eb;color:#fff;border-color:#2563eb}"]})};export{G as HistoryPageComponent};
