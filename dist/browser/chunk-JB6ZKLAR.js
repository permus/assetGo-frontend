import{a as g}from"./chunk-6WXWVH7L.js";import{E as m}from"./chunk-EZ3G6TVP.js";import{U as r,X as l,aa as p,g as s}from"./chunk-FQB2CJ4H.js";import{a as u}from"./chunk-EQDQRRRY.js";var h=class i{constructor(e){this.http=e;this.loadUserFromStorage()}apiUrl=g.apiUrl;currentUserSubject=new s(null);currentUser$=this.currentUserSubject.asObservable();moduleAccessSubject=new s({});moduleAccess$=this.moduleAccessSubject.asObservable();permissionsSubject=new s({});permissions$=this.permissionsSubject.asObservable();getAuthHeaders(){let e=this.getToken();return{headers:u({"Content-Type":"application/json"},e?{Authorization:`Bearer ${e}`}:{})}}register(e){return this.http.post(`${this.apiUrl}/register`,e,this.getAuthHeaders())}login(e){return this.http.post(`${this.apiUrl}/login`,e,{headers:{"Content-Type":"application/json"}}).pipe(r(t=>{t.success&&t.data?.token&&(this.setSession(t.data.token,t.data.user),t.data?.module_access&&(this.moduleAccessSubject.next(t.data.module_access),localStorage.setItem("module_access",JSON.stringify(t.data.module_access))),t.data?.permissions&&(this.permissionsSubject.next(t.data.permissions),localStorage.setItem("permissions",JSON.stringify(t.data.permissions))))}))}forgotPassword(e){return this.http.post(`${this.apiUrl}/forgot-password`,e,this.getAuthHeaders())}resetPassword(e){return this.http.post(`${this.apiUrl}/reset-password`,e,this.getAuthHeaders())}verifyEmail(e,t){return this.http.get(`${this.apiUrl}/email/verify/${e}/${t}`,this.getAuthHeaders())}resendVerification(e){return this.http.post(`${this.apiUrl}/email/resend`,e||{},this.getAuthHeaders())}getProfile(){return this.http.get(`${this.apiUrl}/profile`,this.getAuthHeaders())}logout(){return this.http.post(`${this.apiUrl}/logout`,{},this.getAuthHeaders()).pipe(r(()=>{this.clearSession()}))}logoutAll(){return this.http.post(`${this.apiUrl}/logout-all`,{}).pipe(r(()=>{this.clearSession()}))}isAuthenticated(){return!!localStorage.getItem("token")}getToken(){return localStorage.getItem("token")}getCurrentUser(){return this.currentUserSubject.value}getModuleAccess(){return this.moduleAccessSubject.value}getPermissions(){return this.permissionsSubject.value}hasModuleAccess(e){return this.getModuleAccess()[e]===!0}hasPermission(e,t){return this.getPermissions()[e]?.[t]===!0}setSession(e,t){localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t)),this.currentUserSubject.next(t)}clearSession(){localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("module_access"),localStorage.removeItem("permissions"),this.currentUserSubject.next(null),this.moduleAccessSubject.next({}),this.permissionsSubject.next({})}loadUserFromStorage(){let e=localStorage.getItem("token"),t=localStorage.getItem("user"),o=localStorage.getItem("module_access"),a=localStorage.getItem("permissions");if(e&&t)try{let c=JSON.parse(t);if(this.currentUserSubject.next(c),o){let n=JSON.parse(o);this.moduleAccessSubject.next(n)}if(a){let n=JSON.parse(a);this.permissionsSubject.next(n)}}catch{this.clearSession()}}updateCurrentUser(e){this.currentUserSubject.next(e),localStorage.setItem("user",JSON.stringify(e))}static \u0275fac=function(t){return new(t||i)(p(m))};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};export{h as a};
