import{a as R}from"./chunk-KUZRVUCX.js";import{b as $}from"./chunk-7GLOR2ND.js";import"./chunk-PSU7LOXN.js";import"./chunk-RF5RBUBT.js";import{B}from"./chunk-E3TUIQ6F.js";import"./chunk-47ABMRM7.js";import{k as j,l as L,x as z}from"./chunk-SXJTW2OO.js";import{Bc as I,Gb as e,Hb as n,Ib as m,Jb as P,Kb as O,Qb as y,S as D,Xa as s,ab as T,ba as M,bc as i,cc as p,f as A,jb as F,ka as v,la as f,ob as u,vb as b,wb as g,xb as h}from"./chunk-XGV57TRJ.js";import{a as w,b as E}from"./chunk-EQDQRRRY.js";function Z(c,t){if(c&1&&(P(0),m(1,"div",39),O()),c&2){let r=t.$implicit,o=t.index,d=y();s(),h("height",(r||0)*12,"%"),b("title",d.trendLabels[o]+": "+r)}}function U(c,t){if(c&1&&(e(0,"span"),i(1),n()),c&2){let r=t.$implicit;s(),p(r)}}function K(c,t){c&1&&(e(0,"div",40),i(1," No maintenance types data available "),n())}function Y(c,t){if(c&1&&(e(0,"div",43),m(1,"div",44),e(2,"div",45),i(3),n()()),c&2){let r=t.$implicit;s(),h("height",r.normalizedValue||0,"%"),b("title",r.name+": "+r.value),s(2),p(r.name)}}function q(c,t){if(c&1&&(e(0,"div",41),u(1,Y,4,4,"div",42),n()),c&2){let r=y();s(),g("ngForOf",r.typeBreakdown)}}function J(c,t){if(c&1&&(P(0),m(1,"div",46),O()),c&2){let r=t.$implicit,o=t.index,d=y();s(),h("height",r||0,"%"),b("title",d.monthlyCostsLabels[o]+": "+d.formatCurrency(d.monthlyCostsActual[o]||0))}}function Q(c,t){if(c&1&&(e(0,"span"),i(1),n()),c&2){let r=t.$implicit;s(),p(r)}}var V=class c{constructor(t){this.api=t}loading=!1;error=null;trendLabels=[];trendData=[];typeBreakdown=[];monthlyCostsLabels=[];monthlyCostsData=[];monthlyCostsActual=[];stats={totalMaintenance:0,preventiveCount:0,preventiveRatio:0,avgCost:0,avgDuration:0};destroy$=new A;currencyService=M($);cdr=M(I);currentCurrency="USD";ngOnInit(){this.currencyService.get$().pipe(D(this.destroy$)).subscribe(t=>{this.currentCurrency=t,this.cdr.markForCheck()}),this.fetch(),this.fetchStats()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}fetch(){this.loading=!0,this.api.listSchedules({per_page:500}).subscribe({next:t=>{let r=Array.isArray(t?.data)?t.data:Array.isArray(t?.data?.schedules)?t.data.schedules:[],o={},d={};for(let a of r){let l=a.due_date?new Date(a.due_date):null,C=l&&!isNaN(l.getTime())?`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`:"unknown";o[C]=(o[C]||0)+1;let S=0;a.assets&&Array.isArray(a.assets)&&(S=a.assets.reduce((G,H)=>G+(parseFloat(H.purchase_price)||0),0)),d[C]=(d[C]||0)+S}this.trendLabels=Object.keys(o).sort(),this.trendData=this.trendLabels.map(a=>o[a]),this.monthlyCostsLabels=Object.keys(d).sort(),this.monthlyCostsActual=this.monthlyCostsLabels.map(a=>d[a]||0);let k=Math.max(...this.monthlyCostsActual,1);this.monthlyCostsData=this.monthlyCostsActual.map(a=>k>0?a/k*100:0);let _={};for(let a of r){let l=a.plan_type||a.plan?.plan_type||"preventive";_[l]=(_[l]||0)+1}let N={preventive:"Preventive",predictive:"Predictive",condition_based:"Condition Based",corrective:"Corrective",emergency:"Emergency"},x=Object.entries(_).filter(([a,l])=>l>0).map(([a,l])=>({name:N[a]||a.charAt(0).toUpperCase()+a.slice(1).replace(/_/g," "),value:l})).sort((a,l)=>l.value-a.value);if(x.length>0){let a=Math.max(...x.map(l=>l.value),1);this.typeBreakdown=x.map(l=>E(w({},l),{normalizedValue:a>0?l.value/a*100:0}))}else this.typeBreakdown=[];this.loading=!1},error:()=>{this.loading=!1,this.error="Failed to load analytics"}})}fetchStats(){this.api.getAnalyticsStats().subscribe({next:t=>{t?.success&&t?.data&&(this.stats={totalMaintenance:t.data.totalMaintenance||0,preventiveCount:t.data.preventiveCount||0,preventiveRatio:t.data.preventiveRatio||0,avgCost:t.data.avgCost||0,avgDuration:t.data.avgDuration||0})},error:()=>{}})}formatCurrency(t){return this.currencyService.format(t)}formatDuration(t){return`${t.toFixed(1)}h`}formatPercentage(t){return`${t.toFixed(1)}%`}get totalCount(){return this.stats.totalMaintenance}static \u0275fac=function(r){return new(r||c)(T(R))};static \u0275cmp=F({type:c,selectors:[["app-analytics-page"]],decls:87,vars:10,consts:[[1,"min-h-screen","bg-gray-50","text-gray-900","p-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-xl","font-semibold"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","mb-4","metrics-grid"],[1,"metric-card","info"],[1,"metric-header"],[1,"title"],[1,"badge"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","d","M21.75 6.75a4.5 4.5 0 0 1-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 1 1-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 0 1 6.336-4.486l-3.276 3.276a3.004 3.004 0 0 0 2.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852Z"],["stroke-linecap","round","stroke-linejoin","round","d","M4.867 19.125h.008v.008h-.008v-.008Z"],[1,"value"],[1,"hint"],[1,"metric-card","success"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","d","M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941"],[1,"value","text-green-600"],[1,"metric-card","warning"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5","text-orange-600"],["stroke-linecap","round","stroke-linejoin","round","d","M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"],[1,"metric-card","danger"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5","text-red-600"],["stroke-linecap","round","stroke-linejoin","round","d","M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"panel"],[1,"panel-title"],[1,"grid","grid-cols-12","gap-1","text-xs","text-gray-400"],[1,"col-span-12","flex","items-end","h-48","space-x-2"],[4,"ngFor","ngForOf"],[1,"col-span-12","flex","justify-between","mt-2"],["class","flex items-center justify-center h-48 text-gray-400 text-sm",4,"ngIf"],["class","flex items-end h-48 space-x-3",4,"ngIf"],[1,"panel","mt-4"],[1,"panel-title","!mb-0"],[1,"text-sm","text-gray-500","mb-3"],[1,"list-none","text-sm","text-lg"],[1,"flex","items-center","gap-2","text-md","text-yellow-400","mb-2"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-5"],[1,"flex","items-center","gap-2","text-md","text-gray-500"],[1,"bar"],[1,"flex","items-center","justify-center","h-48","text-gray-400","text-sm"],[1,"flex","items-end","h-48","space-x-3"],["class","w-12",4,"ngFor","ngForOf"],[1,"w-12"],[1,"bar","bg-purple-500"],[1,"text-xs","text-center","mt-1"],[1,"bar","bg-emerald-500"]],template:function(r,o){r&1&&(e(0,"div",0)(1,"div",1)(2,"h1",2),i(3,"Preventive Maintenance Analytics"),n()(),e(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6),i(8,"Total Maintenance"),n(),e(9,"div",7),v(),e(10,"svg",8),m(11,"path",9)(12,"path",10),n()()(),f(),e(13,"div",11),i(14),n(),e(15,"div",12),i(16,"0 upcoming"),n()(),e(17,"div",13)(18,"div",5)(19,"div",6),i(20,"Preventive Ratio"),n(),e(21,"div",7),v(),e(22,"svg",14),m(23,"path",15),n()()(),f(),e(24,"div",16),i(25),n(),e(26,"div",12),i(27,"Target: 80%"),n()(),e(28,"div",17)(29,"div",5)(30,"div",6),i(31,"Avg Cost"),n(),e(32,"div",7),v(),e(33,"svg",18),m(34,"path",19),n()()(),f(),e(35,"div",11),i(36),n(),e(37,"div",12),i(38,"Per maintenance activity"),n()(),e(39,"div",20)(40,"div",5)(41,"div",6),i(42,"Avg Duration"),n(),e(43,"div",7),v(),e(44,"svg",21),m(45,"path",22),n()()(),f(),e(46,"div",11),i(47),n(),e(48,"div",12),i(49,"Per maintenance activity"),n()()(),e(50,"div",23)(51,"div",24)(52,"div",25),i(53,"Maintenance Trend"),n(),e(54,"div",26)(55,"div",27),u(56,Z,2,3,"ng-container",28),n(),e(57,"div",29),u(58,U,2,1,"span",28),n()()(),e(59,"div",24)(60,"div",25),i(61,"Maintenance Types"),n(),u(62,K,2,0,"div",30)(63,q,2,1,"div",31),n()(),e(64,"div",32)(65,"div",25),i(66,"Maintenance Costs"),n(),e(67,"div",26)(68,"div",27),u(69,J,2,3,"ng-container",28),n(),e(70,"div",29),u(71,Q,2,1,"span",28),n()()(),e(72,"div",32)(73,"div",33),i(74,"Key Insights"),n(),e(75,"p",34),i(76,"Automated analysis of your maintenance performance"),n(),e(77,"ul",35)(78,"li",36),v(),e(79,"svg",37),m(80,"path",15),n(),i(81," Consider increasing preventive maintenance to reduce corrective work."),n(),f(),e(82,"li",38),v(),e(83,"svg",37),m(84,"path",9)(85,"path",10),n(),i(86," No maintenance history found. Start by completing some maintenance activities."),n()()()()),r&2&&(s(14),p(o.stats.totalMaintenance),s(11),p(o.formatPercentage(o.stats.preventiveRatio)),s(11),p(o.formatCurrency(o.stats.avgCost)),s(11),p(o.formatDuration(o.stats.avgDuration)),s(9),g("ngForOf",o.trendData),s(2),g("ngForOf",o.trendLabels),s(4),g("ngIf",o.typeBreakdown.length===0),s(),g("ngIf",o.typeBreakdown.length>0),s(6),g("ngForOf",o.monthlyCostsData),s(2),g("ngForOf",o.monthlyCostsLabels))},dependencies:[z,j,L,B],styles:[".card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;padding:1rem}.dark[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{background:#1f2937;border-color:#374151}.label[_ngcontent-%COMP%]{font-size:.75rem;color:#6b7280}.dark[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#9ca3af}.sublabel[_ngcontent-%COMP%]{font-size:.7rem;color:#9ca3af}.dark[_ngcontent-%COMP%]   .sublabel[_ngcontent-%COMP%]{color:#6b7280}.value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#111827}.dark[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#f3f4f6}.panel[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;padding:1rem}.dark[_ngcontent-%COMP%]   .panel[_ngcontent-%COMP%]{background:#1f2937;border-color:#374151}.panel-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.5rem;color:#111827}.dark[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%]{color:#f3f4f6}.bar[_ngcontent-%COMP%]{width:20px;background:#3b82f6;border-radius:.25rem}.shadow-sm[_ngcontent-%COMP%]{box-shadow:0 1px 2px #0000000d}.metrics-grid[_ngcontent-%COMP%]{align-items:stretch}.metric-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:1rem;box-shadow:0 1px 2px #0000000a}.dark[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]{background:#1f2937;border-color:#374151}.metric-card[_ngcontent-%COMP%]   .metric-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:.5rem}.metric-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:600;color:#111827}.dark[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#f3f4f6}.metric-card[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#e5f0ff;color:#2563eb;border-radius:10px;padding:.35rem .5rem;font-size:.75rem}.dark[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{background:#1e3a8a;color:#93c5fd}.metric-card.info[_ngcontent-%COMP%]{background:#f2f8ff;border-color:#dbeafe}.dark[_ngcontent-%COMP%]   .metric-card.info[_ngcontent-%COMP%]{background:#1e3a8a20;border-color:#1e40af}.metric-card.success[_ngcontent-%COMP%]{background:#f2fffa;border-color:#d1fae5}.dark[_ngcontent-%COMP%]   .metric-card.success[_ngcontent-%COMP%]{background:#064e3b20;border-color:#065f46}.metric-card.warning[_ngcontent-%COMP%]{background:#fff8ed;border-color:#fde68a}.dark[_ngcontent-%COMP%]   .metric-card.warning[_ngcontent-%COMP%]{background:#78350f20;border-color:#92400e}.metric-card.danger[_ngcontent-%COMP%]{background:#fff5f5;border-color:#fecaca}.dark[_ngcontent-%COMP%]   .metric-card.danger[_ngcontent-%COMP%]{background:#7f1d1d20;border-color:#991b1b}.metric-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:#0f172a}.dark[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#f3f4f6}.metric-card[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{margin-top:.5rem;font-size:.875rem;color:#6b7280}.dark[_ngcontent-%COMP%]   .metric-card[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{color:#9ca3af}"]})};export{V as AnalyticsPageComponent};
