{
  "version": 3,
  "sources": ["src/app/core/services/module-access.service.ts"],
  "sourcesContent": ["import { Injectable } from '@angular/core';\r\nimport { Observable, BehaviorSubject, combineLatest } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { AuthService } from './auth.service';\r\nimport { SettingsService, ModuleItem } from '../../settings/settings.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ModuleAccessService {\r\n  private visibleModulesSubject = new BehaviorSubject<Record<string, boolean>>({});\r\n  public visibleModules$ = this.visibleModulesSubject.asObservable();\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private settingsService: SettingsService\r\n  ) {\r\n    // Combine module access from permissions and module settings\r\n    combineLatest([\r\n      this.authService.moduleAccess$,\r\n      this.settingsService.getModulesEnabled$()\r\n    ]).subscribe(([moduleAccess, enabledModules]) => {\r\n      const visibleModules: Record<string, boolean> = {};\r\n      \r\n      // Check each module for both permission access and enabled status\r\n      Object.keys(moduleAccess).forEach(moduleKey => {\r\n        const hasPermission = moduleAccess[moduleKey];\r\n        const isEnabled = enabledModules[moduleKey] ?? true; // Default to enabled if not specified\r\n        \r\n        // Module is visible if user has permission AND module is enabled\r\n        visibleModules[moduleKey] = hasPermission && isEnabled;\r\n      });\r\n      \r\n      this.visibleModulesSubject.next(visibleModules);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Check if a module should be visible to the current user\r\n   */\r\n  isModuleVisible(moduleKey: string): boolean {\r\n    const visibleModules = this.visibleModulesSubject.value;\r\n    return visibleModules[moduleKey] === true;\r\n  }\r\n\r\n  /**\r\n   * Get all visible modules\r\n   */\r\n  getVisibleModules(): Record<string, boolean> {\r\n    return this.visibleModulesSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Check if user has access to a specific module\r\n   */\r\n  hasModuleAccess(moduleKey: string): boolean {\r\n    return this.authService.hasModuleAccess(moduleKey);\r\n  }\r\n\r\n  /**\r\n   * Check if user has a specific permission\r\n   */\r\n  hasPermission(module: string, action: string): boolean {\r\n    return this.authService.hasPermission(module, action);\r\n  }\r\n\r\n  /**\r\n   * Get filtered modules based on user access\r\n   */\r\n  getFilteredModules(modules: ModuleItem[]): ModuleItem[] {\r\n    const visibleModules = this.getVisibleModules();\r\n    \r\n    return modules.filter(module => {\r\n      // System modules (dashboard, settings) are always visible if user has access\r\n      if (module.is_system_module) {\r\n        return visibleModules[module.key] === true;\r\n      }\r\n      \r\n      // Regular modules need both permission and enabled status\r\n      return visibleModules[module.key] === true;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Check if user can access a route\r\n   */\r\n  canAccessRoute(routePath: string): boolean {\r\n    // Map route paths to module keys\r\n    const routeToModuleMap: Record<string, string> = {\r\n      '/dashboard': 'dashboard',\r\n      '/settings': 'settings',\r\n      '/assets': 'assets',\r\n      '/assets/list': 'assets',\r\n      '/locations': 'locations',\r\n      '/work-orders': 'work_orders',\r\n      '/teams': 'teams',\r\n      '/maintenance': 'maintenance',\r\n      '/inventory': 'inventory',\r\n      '/sensors': 'sensors',\r\n      '/ai': 'ai_features',\r\n      '/reports': 'reports',\r\n      '/facilities-locations': 'facilities_locations',\r\n      '/sla': 'sla',\r\n      '/eservices': 'eservices',\r\n      '/tenant-portal': 'tenant_portal',\r\n      '/maintenance-requests': 'maintenance_requests',\r\n      '/amenity-bookings': 'amenity_bookings',\r\n      '/move-requests': 'move_in_out_requests',\r\n      '/fitout-requests': 'fitout_requests',\r\n      '/inhouse-services': 'inhouse_services',\r\n      '/parcels': 'parcel_management',\r\n      '/visitors': 'visitor_management',\r\n      '/business-directory': 'business_directory',\r\n      '/tenant-communication': 'tenant_communication',\r\n    };\r\n\r\n    const moduleKey = routeToModuleMap[routePath];\r\n    if (!moduleKey) {\r\n      // If route is not mapped, allow access (for unknown routes)\r\n      return true;\r\n    }\r\n\r\n    return this.isModuleVisible(moduleKey);\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;AASM,IAAO,sBAAP,MAAO,qBAAmB;EAKpB;EACA;EALF,wBAAwB,IAAI,gBAAyC,CAAA,CAAE;EACxE,kBAAkB,KAAK,sBAAsB,aAAY;EAEhE,YACU,aACA,iBAAgC;AADhC,SAAA,cAAA;AACA,SAAA,kBAAA;AAGR,kBAAc;MACZ,KAAK,YAAY;MACjB,KAAK,gBAAgB,mBAAkB;KACxC,EAAE,UAAU,CAAC,CAAC,cAAc,cAAc,MAAK;AAC9C,YAAM,iBAA0C,CAAA;AAGhD,aAAO,KAAK,YAAY,EAAE,QAAQ,eAAY;AAC5C,cAAM,gBAAgB,aAAa,SAAS;AAC5C,cAAM,YAAY,eAAe,SAAS,KAAK;AAG/C,uBAAe,SAAS,IAAI,iBAAiB;MAC/C,CAAC;AAED,WAAK,sBAAsB,KAAK,cAAc;IAChD,CAAC;EACH;;;;EAKA,gBAAgB,WAAiB;AAC/B,UAAM,iBAAiB,KAAK,sBAAsB;AAClD,WAAO,eAAe,SAAS,MAAM;EACvC;;;;EAKA,oBAAiB;AACf,WAAO,KAAK,sBAAsB;EACpC;;;;EAKA,gBAAgB,WAAiB;AAC/B,WAAO,KAAK,YAAY,gBAAgB,SAAS;EACnD;;;;EAKA,cAAc,QAAgB,QAAc;AAC1C,WAAO,KAAK,YAAY,cAAc,QAAQ,MAAM;EACtD;;;;EAKA,mBAAmB,SAAqB;AACtC,UAAM,iBAAiB,KAAK,kBAAiB;AAE7C,WAAO,QAAQ,OAAO,YAAS;AAE7B,UAAI,OAAO,kBAAkB;AAC3B,eAAO,eAAe,OAAO,GAAG,MAAM;MACxC;AAGA,aAAO,eAAe,OAAO,GAAG,MAAM;IACxC,CAAC;EACH;;;;EAKA,eAAe,WAAiB;AAE9B,UAAM,mBAA2C;MAC/C,cAAc;MACd,aAAa;MACb,WAAW;MACX,gBAAgB;MAChB,cAAc;MACd,gBAAgB;MAChB,UAAU;MACV,gBAAgB;MAChB,cAAc;MACd,YAAY;MACZ,OAAO;MACP,YAAY;MACZ,yBAAyB;MACzB,QAAQ;MACR,cAAc;MACd,kBAAkB;MAClB,yBAAyB;MACzB,qBAAqB;MACrB,kBAAkB;MAClB,oBAAoB;MACpB,qBAAqB;MACrB,YAAY;MACZ,aAAa;MACb,uBAAuB;MACvB,yBAAyB;;AAG3B,UAAM,YAAY,iBAAiB,SAAS;AAC5C,QAAI,CAAC,WAAW;AAEd,aAAO;IACT;AAEA,WAAO,KAAK,gBAAgB,SAAS;EACvC;;qCAlHW,sBAAmB,mBAAA,WAAA,GAAA,mBAAA,eAAA,CAAA;EAAA;4EAAnB,sBAAmB,SAAnB,qBAAmB,WAAA,YAFlB,OAAM,CAAA;;;sEAEP,qBAAmB,CAAA;UAH/B;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
