import{a as p}from"./chunk-47ABMRM7.js";import{F as d}from"./chunk-CDW6MD7D.js";import{U as r,X as i,ba as a,g as o,r as n}from"./chunk-ZHYBNXXX.js";var l=class s{http=a(d);base=p.apiUrl;modulesEnabled$=new o({});modulesLoaded=!1;modulesLoading=!1;getCompany(){return this.http.get(`${this.base}/company`)}updateCompany(e){return this.http.put(`${this.base}/company`,e)}updateCurrency(e){return this.http.put(`${this.base}/settings/currency`,{currency:e})}uploadCompanyLogo(e){let t=new FormData;return t.append("logo",e),this.http.post(`${this.base}/settings/company/logo`,t)}listModules(){return this.modulesLoading?this.modulesEnabled$.asObservable().pipe(n(()=>({success:!0,data:{modules:[]}}))):(this.modulesLoading=!0,this.http.get(`${this.base}/settings/modules`).pipe(r(e=>{this.pushModulesEnabled(e?.data?.modules||[]),this.modulesLoaded=!0,this.modulesLoading=!1})))}enableModule(e){return this.http.post(`${this.base}/settings/modules/${e}/enable`,{}).pipe(r(()=>this.refreshModulesEnabled().subscribe()))}disableModule(e){return this.http.post(`${this.base}/settings/modules/${e}/disable`,{}).pipe(r(()=>this.refreshModulesEnabled().subscribe()))}getPreferences(){return this.http.get(`${this.base}/settings/preferences`)}updatePreferences(e){return this.http.put(`${this.base}/settings/preferences`,e)}getModulesEnabled$(){if(!this.modulesLoaded&&!this.modulesLoading){let e=this.modulesEnabled$.value;Object.keys(e).length===0?(this.modulesLoading=!0,this.listModules().subscribe({next:()=>{this.modulesLoaded=!0,this.modulesLoading=!1},error:()=>{this.modulesLoading=!1}})):this.modulesLoaded=!0}return this.modulesEnabled$.asObservable()}refreshModulesEnabled(){return this.modulesLoaded=!1,this.listModules()}pushModulesEnabled(e){let t={};for(let u of e)t[u.key]=!!u.is_enabled;this.modulesEnabled$.next(t)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"})};var m=class s{settings=a(l);currency$=new o("USD");refreshing=!1;currencySymbols={USD:"$",AED:"\u062F.\u0625"};refreshFromServer(){return this.refreshing?this.currency$.asObservable().pipe(n(e=>e)):(this.refreshing=!0,this.settings.getCompany().pipe(n(e=>e?.data?.company?.currency||"USD"),r(e=>{this.currency$.next(e),this.refreshing=!1})))}get$(){return this.currency$.asObservable()}getCurrent(){return this.currency$.getValue()}getSymbol(){let e=this.getCurrent();return this.currencySymbols[e]||e}format(e){let t=Number(e??0);return isFinite(t)?`${this.getSymbol()}${t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`:`${this.getSymbol()}0.00`}static \u0275fac=function(t){return new(t||s)};static \u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"})};export{l as a,m as b};
