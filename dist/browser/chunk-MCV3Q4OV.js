import{a as M}from"./chunk-VPAYI7QR.js";import{A as j,C as N,c as R,d as f,e as F,f as V,j as L,o as T,r as A,x as G}from"./chunk-UQACUQIP.js";import"./chunk-MEXLA3FU.js";import{d as E,f as k}from"./chunk-4LZAODCJ.js";import"./chunk-YGU4T3V7.js";import{l as I}from"./chunk-HV2J6S7U.js";import{Gb as i,Hb as o,Ib as p,Mb as h,Pb as v,Qb as m,Va as C,Ya as s,bb as u,bc as n,cc as _,dc as P,ja as g,ka as w,kb as S,la as x,ma as b,pb as c,wb as d,yb as y}from"./chunk-RHVXZUNF.js";import"./chunk-EQDQRRRY.js";function D(t,r){t&1&&(i(0,"p",6),n(1,"Enter your new password below"),o())}function B(t,r){t&1&&(i(0,"p",6),n(1,"Password Reset Instructions"),o())}function O(t,r){if(t&1&&(i(0,"div",16)(1,"div",17),x(),i(2,"svg",18),p(3,"path",19),o(),b(),i(4,"p",20),n(5),o()()()),t&2){let e=m(2);s(5),_(e.infoMessage)}}function z(t,r){if(t&1&&(i(0,"div",21)(1,"p",22),n(2),o()()),t&2){let e=m(2);s(2),_(e.errorMessage)}}function H(t,r){if(t&1&&(i(0,"div",33),n(1),o()),t&2){let e=m(3);s(),P(" ",e.getPasswordErrorMessage()," ")}}function Y(t,r){if(t&1&&(i(0,"div",33),n(1),o()),t&2){let e=m(3);s(),P(" ",e.getConfirmPasswordErrorMessage()," ")}}function U(t,r){t&1&&(i(0,"span"),n(1,"Reset Password"),o())}function Z(t,r){t&1&&(i(0,"span",34),x(),i(1,"svg",35),p(2,"circle",36)(3,"path",37),o(),n(4," Resetting... "),o())}function $(t,r){if(t&1){let e=h();i(0,"form",23),v("ngSubmit",function(){g(e);let a=m(2);return w(a.onSubmit())}),i(1,"div",24)(2,"div")(3,"label",25),n(4,"New Password"),o(),p(5,"input",26),c(6,H,2,1,"div",27),o(),i(7,"div")(8,"label",28),n(9,"Confirm New Password"),o(),p(10,"input",29),c(11,Y,2,1,"div",27),o(),i(12,"button",30),c(13,U,2,0,"span",31)(14,Z,5,0,"span",32),o()()()}if(t&2){let e,l,a=m(2);d("formGroup",a.resetPasswordForm),s(5),y("border-red-300",((e=a.resetPasswordForm.get("password"))==null?null:e.invalid)&&((e=a.resetPasswordForm.get("password"))==null?null:e.touched)),s(),d("ngIf",a.getPasswordErrorMessage()),s(4),y("border-red-300",((l=a.resetPasswordForm.get("password_confirmation"))==null?null:l.invalid)&&((l=a.resetPasswordForm.get("password_confirmation"))==null?null:l.touched)),s(),d("ngIf",a.getConfirmPasswordErrorMessage()),s(),d("disabled",a.resetPasswordForm.invalid||a.isLoading),s(),d("ngIf",!a.isLoading),s(),d("ngIf",a.isLoading)}}function J(t,r){if(t&1){let e=h();i(0,"div",38)(1,"button",39),v("click",function(){g(e);let a=m(2);return w(a.goToLogin())}),n(2," \u2190 Back to Sign In "),o()()}}function K(t,r){if(t&1&&(i(0,"div",8)(1,"div",9)(2,"h2",10),n(3,"Reset Password"),o(),c(4,D,2,0,"p",11)(5,B,2,0,"p",11),o(),c(6,O,6,1,"div",12)(7,z,3,1,"div",13)(8,$,15,10,"form",14)(9,J,3,0,"div",15),o()),t&2){let e=m();s(4),d("ngIf",e.hasValidLink),s(),d("ngIf",!e.hasValidLink),s(),d("ngIf",e.infoMessage&&!e.hasValidLink),s(),d("ngIf",e.errorMessage),s(),d("ngIf",e.hasValidLink),s(),d("ngIf",e.hasValidLink||e.infoMessage)}}function Q(t,r){if(t&1){let e=h();i(0,"div",8)(1,"div",2)(2,"div",3)(3,"div",40),x(),i(4,"svg",41),p(5,"path",42),o()()(),b(),i(6,"h2",43),n(7,"Password Reset Successfully!"),o(),i(8,"p",44),n(9," Your password has been reset successfully. You can now log in with your new password. "),o(),i(10,"div",45)(11,"p",20),n(12," Redirecting to login page in "),i(13,"span",46),n(14),o(),n(15," seconds "),o()(),i(16,"button",47),v("click",function(){g(e);let a=m();return w(a.goToLogin())}),n(17," Go to login now "),o()()()}if(t&2){let e=m();s(14),_(e.countdown)}}var q=class t{constructor(r,e,l,a){this.fb=r;this.router=e;this.route=l;this.authService=a;this.resetPasswordForm=this.fb.group({password:["",[f.required,f.minLength(8),f.pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/)]],password_confirmation:["",[f.required]]},{validators:this.passwordMatchValidator})}resetPasswordForm;isLoading=!1;errorMessage="";infoMessage="";showSuccessMessage=!1;countdown=10;countdownInterval;token="";email="";hasValidLink=!1;ngOnInit(){this.token=this.route.snapshot.queryParams.token||"",this.email=this.route.snapshot.queryParams.email||"",this.token&&this.email?this.hasValidLink=!0:this.infoMessage="Please check your email for the password reset link. Click the link in the email to reset your password."}passwordMatchValidator(r){let e=r.get("password"),l=r.get("password_confirmation");return e&&l&&e.value===l.value?null:{passwordMismatch:!0}}onSubmit(){if(this.resetPasswordForm.invalid){Object.keys(this.resetPasswordForm.controls).forEach(r=>{this.resetPasswordForm.get(r)?.markAsTouched()});return}if(this.resetPasswordForm.valid&&!this.isLoading&&this.token&&this.email){this.isLoading=!0,this.errorMessage="",this.showSuccessMessage=!1;let r={token:this.token,email:this.email,password:this.resetPasswordForm.value.password,password_confirmation:this.resetPasswordForm.value.password_confirmation};this.authService.resetPassword(r).subscribe({next:e=>{e.success?(this.showSuccessMessage=!0,this.startCountdown()):this.errorMessage=e.message||"Failed to reset password",this.isLoading=!1},error:e=>{this.errorMessage=e.error?.message||e.error?.error||"An error occurred",this.isLoading=!1}})}}startCountdown(){this.countdown=10,this.countdownInterval=setInterval(()=>{this.countdown--,this.countdown<=0&&(clearInterval(this.countdownInterval),this.router.navigate(["/login"]))},1e3)}ngOnDestroy(){this.countdownInterval&&clearInterval(this.countdownInterval)}goToLogin(){this.router.navigate(["/login"])}getPasswordErrorMessage(){let r=this.resetPasswordForm.get("password");return r?.hasError("required")&&r?.touched?"Password is required":r?.hasError("minlength")&&r?.touched?"Password must be at least 8 characters long":r?.hasError("pattern")&&r?.touched?"Password must contain at least one uppercase letter, one lowercase letter, and one number":""}getConfirmPasswordErrorMessage(){let r=this.resetPasswordForm.get("password_confirmation");return r?.hasError("required")&&r?.touched?"Password confirmation is required":this.resetPasswordForm.errors?.passwordMismatch&&r?.touched?"Passwords do not match":""}static \u0275fac=function(e){return new(e||t)(u(j),u(k),u(E),u(M))};static \u0275cmp=S({type:t,selectors:[["app-reset-password"]],decls:10,vars:3,consts:[[1,"min-h-screen","bg-gray-50","flex","items-center","justify-center","py-12","px-4","sm:px-6","lg:px-8"],[1,"max-w-md","w-full","space-y-8"],[1,"text-center"],[1,"flex","justify-center","mb-6"],[1,"flex","items-center","space-x-3"],["alt","AssetGo Logo",1,"h-20","w-auto",3,"src"],[1,"text-gray-600"],["class","bg-white rounded-2xl shadow-lg p-8 max-w-md mx-auto",4,"ngIf"],[1,"bg-white","rounded-2xl","shadow-lg","p-8","max-w-md","mx-auto"],[1,"text-center","mb-8"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],["class","text-gray-600",4,"ngIf"],["class","mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",4,"ngIf"],["class","mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],["class","text-center mt-6",4,"ngIf"],[1,"mb-4","p-4","bg-blue-50","border","border-blue-200","rounded-lg"],[1,"flex","items-start"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-600","mt-0.5","mr-3","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-blue-800","text-sm"],[1,"mb-4","p-3","bg-red-50","border","border-red-200","rounded-lg"],[1,"text-red-600","text-sm"],[3,"ngSubmit","formGroup"],[1,"space-y-6"],["for","password",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","password","type","password","formControlName","password","placeholder","Enter new password","required","",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","placeholder-gray-400"],["class","text-red-500 text-xs mt-1",4,"ngIf"],["for","password_confirmation",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","password_confirmation","type","password","formControlName","password_confirmation","placeholder","Confirm new password","required","",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","placeholder-gray-400"],["type","submit",1,"w-full","bg-blue-600","text-white","py-3","px-4","rounded-lg","font-medium","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","transition-all","disabled:opacity-50","disabled:cursor-not-allowed","cursor-pointer",3,"disabled"],[4,"ngIf"],["class","flex items-center justify-center",4,"ngIf"],[1,"text-red-500","text-xs","mt-1"],[1,"flex","items-center","justify-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-center","mt-6"],["type","button",1,"text-blue-600","hover:text-blue-500","text-sm","font-medium","cursor-pointer",3,"click"],[1,"w-16","h-16","bg-green-100","rounded-full","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-2xl","font-bold","text-gray-900","mb-4"],[1,"text-gray-600","mb-6","leading-relaxed"],[1,"bg-blue-50","rounded-lg","p-4","mb-6"],[1,"font-bold"],[1,"text-blue-600","hover:text-blue-500","text-sm","font-medium","cursor-pointer",3,"click"]],template:function(e,l){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),p(5,"img",5),o()(),i(6,"p",6),n(7,"Enterprise Asset Management System"),o()(),c(8,K,10,6,"div",7)(9,Q,18,1,"div",7),o()()),e&2&&(s(5),d("src","images/logo.png",C),s(3),d("ngIf",!l.showSuccessMessage),s(),d("ngIf",l.showSuccessMessage))},dependencies:[I,N,L,R,F,V,G,T,A],encapsulation:2})};export{q as ResetPasswordComponent};
