import{a as F}from"./chunk-E7W5FHY5.js";import{A,C as j,c as M,d as h,e as k,f as V,j as L,o as T,r as G,x as N}from"./chunk-BV4EONZX.js";import"./chunk-47ABMRM7.js";import{a as R,c as E}from"./chunk-SSTOZ5OJ.js";import"./chunk-J7FUFURU.js";import{l as I}from"./chunk-CDW6MD7D.js";import{Gb as r,Hb as t,Ib as u,Mb as x,Pb as v,Qb as c,Ua as P,Xa as a,ab as p,bc as i,cc as y,ia as w,ja as g,jb as C,ka as _,la as S,ob as f,wb as l,yb as b}from"./chunk-ZHYBNXXX.js";import"./chunk-EQDQRRRY.js";function q(o,n){if(o&1&&(r(0,"div",15)(1,"p",16),i(2),t()()),o&2){let e=c(2);a(2),y(e.errorMessage)}}function B(o,n){o&1&&(r(0,"div",27),i(1," Passwords do not match "),t())}function O(o,n){o&1&&(r(0,"span"),i(1,"Reset Password"),t())}function z(o,n){o&1&&(r(0,"span",28),_(),r(1,"svg",29),u(2,"circle",30)(3,"path",31),t(),i(4," Resetting... "),t())}function H(o,n){if(o&1){let e=x();r(0,"form",17),v("ngSubmit",function(){w(e);let m=c(2);return g(m.onSubmit())}),r(1,"div",18)(2,"div")(3,"label",19),i(4,"New Password"),t(),u(5,"input",20),t(),r(6,"div")(7,"label",21),i(8,"Confirm New Password"),t(),u(9,"input",22),f(10,B,2,0,"div",23),t(),r(11,"button",24),f(12,O,2,0,"span",25)(13,z,5,0,"span",26),t()()()}if(o&2){let e,s,m,d=c(2);l("formGroup",d.resetPasswordForm),a(5),b("border-red-300",((e=d.resetPasswordForm.get("password"))==null?null:e.invalid)&&((e=d.resetPasswordForm.get("password"))==null?null:e.touched)),a(4),b("border-red-300",((s=d.resetPasswordForm.get("password_confirmation"))==null?null:s.invalid)&&((s=d.resetPasswordForm.get("password_confirmation"))==null?null:s.touched)),a(),l("ngIf",(d.resetPasswordForm.errors==null?null:d.resetPasswordForm.errors.passwordMismatch)&&((m=d.resetPasswordForm.get("password_confirmation"))==null?null:m.touched)),a(),l("disabled",d.resetPasswordForm.invalid||d.isLoading),a(),l("ngIf",!d.isLoading),a(),l("ngIf",d.isLoading)}}function Y(o,n){if(o&1){let e=x();r(0,"div",8)(1,"div",9)(2,"h2",10),i(3,"Reset Password"),t(),r(4,"p",6),i(5,"Enter your new password below"),t()(),f(6,q,3,1,"div",11)(7,H,14,9,"form",12),r(8,"div",13)(9,"button",14),v("click",function(){w(e);let m=c();return g(m.goToLogin())}),i(10," \u2190 Back to Sign In "),t()()()}if(o&2){let e=c();a(6),l("ngIf",e.errorMessage),a(),l("ngIf",!e.errorMessage||e.errorMessage&&e.token&&e.email)}}function U(o,n){if(o&1){let e=x();r(0,"div",8)(1,"div",2)(2,"div",3)(3,"div",32),_(),r(4,"svg",33),u(5,"path",34),t()()(),S(),r(6,"h2",35),i(7,"Password Reset Successfully!"),t(),r(8,"p",36),i(9," Your password has been reset successfully. You can now log in with your new password. "),t(),r(10,"div",37)(11,"p",38),i(12," Redirecting to login page in "),r(13,"span",39),i(14),t(),i(15," seconds "),t()(),r(16,"button",40),v("click",function(){w(e);let m=c();return g(m.goToLogin())}),i(17," Go to login now "),t()()()}if(o&2){let e=c();a(14),y(e.countdown)}}var D=class o{constructor(n,e,s,m){this.fb=n;this.router=e;this.route=s;this.authService=m;this.resetPasswordForm=this.fb.group({password:["",[h.required,h.minLength(6)]],password_confirmation:["",[h.required]]},{validators:this.passwordMatchValidator})}resetPasswordForm;isLoading=!1;errorMessage="";showSuccessMessage=!1;countdown=10;countdownInterval;token="";email="";ngOnInit(){this.token=this.route.snapshot.queryParams.token||"",this.email=this.route.snapshot.queryParams.email||"",(!this.token||!this.email)&&(this.errorMessage="Invalid reset link")}passwordMatchValidator(n){let e=n.get("password"),s=n.get("password_confirmation");return e&&s&&e.value===s.value?null:{passwordMismatch:!0}}onSubmit(){if(this.resetPasswordForm.valid&&!this.isLoading&&this.token&&this.email){this.isLoading=!0,this.errorMessage="",this.showSuccessMessage=!1;let n={token:this.token,email:this.email,password:this.resetPasswordForm.value.password,password_confirmation:this.resetPasswordForm.value.password_confirmation};this.authService.resetPassword(n).subscribe({next:e=>{e.success?(this.showSuccessMessage=!0,this.startCountdown()):this.errorMessage=e.message||"Failed to reset password",this.isLoading=!1},error:e=>{this.errorMessage=e.error?.message||e.error?.error||"An error occurred",this.isLoading=!1}})}}startCountdown(){this.countdown=10,this.countdownInterval=setInterval(()=>{this.countdown--,this.countdown<=0&&(clearInterval(this.countdownInterval),this.router.navigate(["/login"]))},1e3)}ngOnDestroy(){this.countdownInterval&&clearInterval(this.countdownInterval)}goToLogin(){this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||o)(p(A),p(E),p(R),p(F))};static \u0275cmp=C({type:o,selectors:[["app-reset-password"]],decls:10,vars:3,consts:[[1,"min-h-screen","bg-gray-50","flex","items-center","justify-center","py-12","px-4","sm:px-6","lg:px-8"],[1,"max-w-md","w-full","space-y-8"],[1,"text-center"],[1,"flex","justify-center","mb-6"],[1,"flex","items-center","space-x-3"],["alt","AssetGo Logo",1,"h-20","w-auto",3,"src"],[1,"text-gray-600"],["class","bg-white rounded-2xl shadow-lg p-8 max-w-md mx-auto",4,"ngIf"],[1,"bg-white","rounded-2xl","shadow-lg","p-8","max-w-md","mx-auto"],[1,"text-center","mb-8"],[1,"text-2xl","font-bold","text-gray-900","mb-2"],["class","mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"text-center","mt-6"],["type","button",1,"text-blue-600","hover:text-blue-500","text-sm","font-medium","cursor-pointer",3,"click"],[1,"mb-4","p-3","bg-red-50","border","border-red-200","rounded-lg"],[1,"text-red-600","text-sm"],[3,"ngSubmit","formGroup"],[1,"space-y-6"],["for","password",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","password","type","password","formControlName","password","placeholder","Enter new password","required","",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","placeholder-gray-400"],["for","password_confirmation",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","password_confirmation","type","password","formControlName","password_confirmation","placeholder","Confirm new password","required","",1,"w-full","px-4","py-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","placeholder-gray-400"],["class","text-red-500 text-xs mt-1",4,"ngIf"],["type","submit",1,"w-full","bg-blue-600","text-white","py-3","px-4","rounded-lg","font-medium","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","transition-all","disabled:opacity-50","disabled:cursor-not-allowed","cursor-pointer",3,"disabled"],[4,"ngIf"],["class","flex items-center justify-center",4,"ngIf"],[1,"text-red-500","text-xs","mt-1"],[1,"flex","items-center","justify-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"w-16","h-16","bg-green-100","rounded-full","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-2xl","font-bold","text-gray-900","mb-4"],[1,"text-gray-600","mb-6","leading-relaxed"],[1,"bg-blue-50","rounded-lg","p-4","mb-6"],[1,"text-blue-800","text-sm"],[1,"font-bold"],[1,"text-blue-600","hover:text-blue-500","text-sm","font-medium","cursor-pointer",3,"click"]],template:function(e,s){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),u(5,"img",5),t()(),r(6,"p",6),i(7,"Enterprise Asset Management System"),t()(),f(8,Y,11,2,"div",7)(9,U,18,1,"div",7),t()()),e&2&&(a(5),l("src","images/logo.png",P),a(3),l("ngIf",!s.showSuccessMessage),a(),l("ngIf",s.showSuccessMessage))},dependencies:[I,j,L,M,k,V,N,T,G],encapsulation:2})};export{D as ResetPasswordComponent};
