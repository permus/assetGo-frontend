import{a as L}from"./chunk-TABBCLNC.js";import{a as U}from"./chunk-GVXPQDBC.js";import{a as K}from"./chunk-GDDPPMTZ.js";import{B as X,c as q,e as Y,i as J}from"./chunk-BBYRNPLF.js";import"./chunk-MEXLA3FU.js";import{d as $,f as Q}from"./chunk-P6C7UJHI.js";import{j as D,k as V,l as O,x as P}from"./chunk-CNTUU5WV.js";import{Cb as E,Gb as n,Hb as o,Ib as f,Mb as C,Pb as m,Qb as c,Ya as s,bb as w,bc as l,cc as h,dc as b,ec as S,gc as k,hc as T,ia as W,ic as A,ja as g,ka as p,kb as y,la as _,ma as v,pb as x,ta as M,wb as d,xb as j,yb as I}from"./chunk-RHVXZUNF.js";import{a as G}from"./chunk-EQDQRRRY.js";function ie(r,t){r&1&&(n(0,"div",19),f(1,"div",20),n(2,"p"),l(3,"Loading users..."),o()())}function oe(r,t){if(r&1&&(n(0,"div",24),_(),n(1,"svg",25),f(2,"path",26),o(),v(),n(3,"p"),l(4),o()()),r&2){let e=c(3);s(4),h(e.searchQuery?"No users found matching your search.":"All users are already assigned.")}}function se(r,t){if(r&1){let e=C();n(0,"div",29),m("click",function(){let a=g(e).$implicit,u=c(4);return p(u.toggleUser(a.id))}),n(1,"div",30)(2,"input",31),m("click",function(a){return g(e),p(a.stopPropagation())}),o()(),n(3,"div",32),l(4),o(),n(5,"div",33)(6,"div",34),l(7),o(),n(8,"div",35),l(9),o()(),n(10,"div",36)(11,"span",37),l(12),o()()()}if(r&2){let e=t.$implicit,i=c(4);I("selected",i.isSelected(e.id)),s(2),d("checked",i.isSelected(e.id))("disabled",i.saving),s(2),b(" ",i.getUserInitials(e)," "),s(3),S("",e.first_name," ",e.last_name,""),s(2),h(e.email),s(2),d("ngClass",i.getRoleBadgeClass(e.user_type)),s(),b(" ",i.getRoleLabel(e.user_type)," ")}}function re(r,t){if(r&1&&(n(0,"div",27),x(1,se,13,10,"div",28),o()),r&2){let e=c(3);s(),d("ngForOf",e.filteredUsers)}}function ae(r,t){if(r&1&&(n(0,"div",21),x(1,oe,5,1,"div",22)(2,re,2,1,"div",23),o()),r&2){let e=c(2);s(),d("ngIf",e.filteredUsers.length===0),s(),d("ngIf",e.filteredUsers.length>0)}}function le(r,t){r&1&&(_(),n(0,"svg",6),f(1,"path",26),o())}function de(r,t){r&1&&f(0,"div",38)}function ce(r,t){if(r&1){let e=C();n(0,"div",1),m("click",function(){g(e);let a=c();return p(a.close())}),n(1,"div",2),m("click",function(a){return g(e),p(a.stopPropagation())}),n(2,"div",3)(3,"h2",4),l(4,"Assign Team Members"),o(),n(5,"button",5),m("click",function(){g(e);let a=c();return p(a.close())}),_(),n(6,"svg",6),f(7,"path",7),o()()(),v(),n(8,"div",8),_(),n(9,"svg",9),f(10,"path",10),o(),v(),n(11,"input",11),A("ngModelChange",function(a){g(e);let u=c();return T(u.searchQuery,a)||(u.searchQuery=a),p(a)}),m("ngModelChange",function(){g(e);let a=c();return p(a.onSearchChange())}),o()(),x(12,ie,4,0,"div",12)(13,ae,3,2,"div",13),n(14,"div",14)(15,"button",15),m("click",function(){g(e);let a=c();return p(a.close())}),l(16," Cancel "),o(),n(17,"button",16),m("click",function(){g(e);let a=c();return p(a.assign())}),x(18,le,2,0,"svg",17)(19,de,1,0,"div",18),l(20),o()()()()}if(r&2){let e=c();s(5),d("disabled",e.saving),s(6),k("ngModel",e.searchQuery),d("disabled",e.loading||e.saving),s(),d("ngIf",e.loading),s(),d("ngIf",!e.loading),s(2),d("disabled",e.saving),s(2),d("disabled",e.selectedUsers.size===0||e.saving),s(),d("ngIf",!e.saving),s(),d("ngIf",e.saving),s(),b(" ",e.saving?"Assigning...":"Assign "+e.selectedUsers.size+" User"+(e.selectedUsers.size!==1?"s":"")," ")}}var z=class r{constructor(t,e){this.service=t;this.toastService=e}scheduleId;isOpen=!1;isOpenChange=new M;assigned=new M;loading=!1;saving=!1;users=[];filteredUsers=[];selectedUsers=new Set;searchQuery="";ngOnInit(){this.isOpen&&this.loadUsers()}ngOnChanges(){this.isOpen&&this.users.length===0&&this.loadUsers()}loadUsers(){this.loading=!0,this.service.getAssignableUsers(this.scheduleId).subscribe({next:t=>{this.users=t.data,this.filteredUsers=this.users,this.loading=!1},error:t=>{console.error("Error loading users:",t),this.loading=!1}})}onSearchChange(){let t=this.searchQuery.toLowerCase();this.filteredUsers=this.users.filter(e=>`${e.first_name} ${e.last_name}`.toLowerCase().includes(t)||e.email.toLowerCase().includes(t))}toggleUser(t){this.selectedUsers.has(t)?this.selectedUsers.delete(t):this.selectedUsers.add(t)}isSelected(t){return this.selectedUsers.has(t)}getUserInitials(t){let e=t.first_name?.charAt(0)||"",i=t.last_name?.charAt(0)||"";return(e+i).toUpperCase()}getRoleBadgeClass(t){return{admin:"badge-admin",manager:"badge-manager",team:"badge-team",owner:"badge-owner"}[t]||"badge-default"}getRoleLabel(t){return{admin:"Admin",manager:"Manager",team:"Team Member",owner:"Owner"}[t]||t}assign(){if(this.selectedUsers.size===0)return;this.saving=!0;let t=Array.from(this.selectedUsers),e=0,i=0,a=!1;t.forEach(u=>{this.service.assignUserToSchedule(this.scheduleId,u).subscribe({next:()=>{e++,i++,e===t.length&&(this.saving=!1,a?(this.toastService.warning(`Assigned ${i} of ${t.length} users. Some assignments failed.`),this.assigned.emit(),this.close()):(this.toastService.success(`Successfully assigned ${i} user${i>1?"s":""}`),this.assigned.emit(),this.close()))},error:ee=>{console.error("Error assigning user:",ee),a=!0,e++,e===t.length&&(this.saving=!1,i>0?(this.toastService.warning(`Assigned ${i} of ${t.length} users. Some assignments failed.`),this.assigned.emit(),this.close()):this.toastService.error("Failed to assign users. Please try again."))}})})}close(){this.isOpen=!1,this.isOpenChange.emit(!1),this.selectedUsers.clear(),this.searchQuery="",this.filteredUsers=this.users}static \u0275fac=function(e){return new(e||r)(w(L),w(U))};static \u0275cmp=y({type:r,selectors:[["app-assign-team-dialog"]],inputs:{scheduleId:"scheduleId",isOpen:"isOpen"},outputs:{isOpenChange:"isOpenChange",assigned:"assigned"},features:[W],decls:1,vars:1,consts:[["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-dialog",3,"click"],[1,"modal-header"],[1,"modal-title"],[1,"btn-close",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"modal-search"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"search-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],["type","text","placeholder","Search by name or email...",1,"search-input",3,"ngModelChange","ngModel","disabled"],["class","modal-loading",4,"ngIf"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],[1,"btn-cancel",3,"click","disabled"],[1,"btn-assign",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",4,"ngIf"],["class","btn-spinner",4,"ngIf"],[1,"modal-loading"],[1,"spinner"],[1,"modal-body"],["class","empty-state",4,"ngIf"],["class","users-list",4,"ngIf"],[1,"empty-state"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"empty-icon"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"],[1,"users-list"],["class","user-card",3,"selected","click",4,"ngFor","ngForOf"],[1,"user-card",3,"click"],[1,"user-checkbox"],["type","checkbox",3,"click","checked","disabled"],[1,"user-avatar"],[1,"user-info"],[1,"user-name"],[1,"user-email"],[1,"user-role"],[1,"role-badge",3,"ngClass"],[1,"btn-spinner"]],template:function(e,i){e&1&&x(0,ce,21,10,"div",0),e&2&&d("ngIf",i.isOpen)},dependencies:[P,D,V,O,X,q,Y,J],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-dialog[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:100%;max-width:600px;max-height:80vh;display:flex;flex-direction:column;box-shadow:0 20px 25px -5px #0000001a,0 10px 10px -5px #0000000a}.modal-header[_ngcontent-%COMP%]{padding:20px 24px;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between}.modal-title[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#1f2937;margin:0}.btn-close[_ngcontent-%COMP%]{padding:8px;background:none;border:none;color:#6b7280;cursor:pointer;border-radius:6px;transition:all .2s}.btn-close[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.btn-close[_ngcontent-%COMP%]:hover:not(:disabled){background:#f3f4f6;color:#1f2937}.btn-close[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.5}.modal-search[_ngcontent-%COMP%]{padding:16px 24px;border-bottom:1px solid #e5e7eb;position:relative}.search-icon[_ngcontent-%COMP%]{position:absolute;left:36px;top:50%;transform:translateY(-50%);width:20px;height:20px;color:#9ca3af;pointer-events:none}.search-input[_ngcontent-%COMP%]{width:100%;padding:10px 12px 10px 40px;border:2px solid #e5e7eb;border-radius:8px;font-size:14px;transition:border-color .2s}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.search-input[_ngcontent-%COMP%]:disabled{background:#f9fafb;cursor:not-allowed}.modal-loading[_ngcontent-%COMP%]{padding:60px 24px;text-align:center;color:#6b7280}.modal-loading[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid #e5e7eb;border-top-color:#3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin:0 auto 16px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.modal-body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:16px 24px;min-height:300px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#6b7280}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{width:64px;height:64px;color:#d1d5db;margin:0 auto 16px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;margin:0}.users-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.user-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;border:2px solid #e5e7eb;border-radius:10px;cursor:pointer;transition:all .2s}.user-card[_ngcontent-%COMP%]:hover{border-color:#d1d5db;background:#f9fafb}.user-card.selected[_ngcontent-%COMP%]{border-color:#3b82f6;background:#eff6ff}.user-checkbox[_ngcontent-%COMP%]{flex-shrink:0}.user-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer}.user-avatar[_ngcontent-%COMP%]{flex-shrink:0;width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:14px}.user-info[_ngcontent-%COMP%]{flex:1;min-width:0}.user-name[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:#1f2937;margin-bottom:2px}.user-email[_ngcontent-%COMP%]{font-size:13px;color:#6b7280;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.user-role[_ngcontent-%COMP%]{flex-shrink:0}.role-badge[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;white-space:nowrap}.role-badge.badge-admin[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.role-badge.badge-manager[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.role-badge.badge-team[_ngcontent-%COMP%]{background:#d1fae5;color:#065f46}.role-badge.badge-owner[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.role-badge.badge-default[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.modal-footer[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e5e7eb;display:flex;gap:12px;justify-content:flex-end}.btn-cancel[_ngcontent-%COMP%], .btn-assign[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;border:none;display:flex;align-items:center;gap:8px}.btn-cancel[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%], .btn-assign[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px}.btn-cancel[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.btn-cancel[_ngcontent-%COMP%]:hover:not(:disabled){background:#e5e7eb}.btn-cancel[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.5}.btn-assign[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.btn-assign[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb}.btn-assign[_ngcontent-%COMP%]:disabled{background:#9ca3af;cursor:not-allowed}.btn-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .6s linear infinite}@media (max-width: 640px){.modal-dialog[_ngcontent-%COMP%]{max-height:90vh}.user-card[_ngcontent-%COMP%]{padding:10px}.user-avatar[_ngcontent-%COMP%]{width:36px;height:36px;font-size:12px}.user-name[_ngcontent-%COMP%]{font-size:14px}.user-email[_ngcontent-%COMP%]{font-size:12px}}"]})};function me(r,t){if(r&1){let e=C();n(0,"div",1),m("click",function(){g(e);let a=c();return p(a.onBackdropClick())})("keydown",function(a){g(e);let u=c();return p(u.onKeyDown(a))}),n(1,"div",2),m("click",function(a){return g(e),p(a.stopPropagation())}),n(2,"div",3)(3,"h3",4),l(4),o(),n(5,"button",5),m("click",function(){g(e);let a=c();return p(a.onCancel())}),_(),n(6,"svg",6),f(7,"path",7),o()()(),v(),n(8,"div",8)(9,"p",9),l(10),o()(),n(11,"div",10)(12,"button",11),m("click",function(){g(e);let a=c();return p(a.onCancel())}),l(13),o(),n(14,"button",12),m("click",function(){g(e);let a=c();return p(a.onConfirm())}),l(15),o()()()()}if(r&2){let e=c();s(4),h(e.title),s(6),h(e.message),s(3),b(" ",e.cancelText," "),s(),I("btn-danger",e.isDanger),s(),b(" ",e.confirmText," ")}}var R=class r{isOpen=!1;title="Confirm Action";message="Are you sure you want to proceed?";confirmText="Confirm";cancelText="Cancel";isDanger=!1;confirmed=new M;cancelled=new M;isOpenChange=new M;onConfirm(){this.confirmed.emit(),this.close()}onCancel(){this.cancelled.emit(),this.close()}close(){this.isOpen=!1,this.isOpenChange.emit(!1)}onBackdropClick(){this.onCancel()}onKeyDown(t){t.key==="Escape"?this.onCancel():t.key==="Enter"&&this.onConfirm()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=y({type:r,selectors:[["app-confirmation-modal"]],inputs:{isOpen:"isOpen",title:"title",message:"message",confirmText:"confirmText",cancelText:"cancelText",isDanger:"isDanger"},outputs:{confirmed:"confirmed",cancelled:"cancelled",isOpenChange:"isOpenChange"},decls:1,vars:1,consts:[["class","modal-overlay","tabindex","0",3,"click","keydown",4,"ngIf"],["tabindex","0",1,"modal-overlay",3,"click","keydown"],[1,"modal-dialog",3,"click"],[1,"modal-header"],[1,"modal-title"],[1,"btn-close",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"modal-body"],[1,"modal-message"],[1,"modal-footer"],[1,"btn","btn-cancel",3,"click"],[1,"btn","btn-confirm",3,"click"]],template:function(e,i){e&1&&x(0,me,16,6,"div",0),e&2&&d("ngIf",i.isOpen)},dependencies:[P,O],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:10000;animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.modal-dialog[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:100%;max-width:500px;margin:20px;box-shadow:0 20px 25px -5px #0000001a,0 10px 10px -5px #0000000a;animation:_ngcontent-%COMP%_scaleIn .2s ease-out}.modal-header[_ngcontent-%COMP%]{padding:20px 24px;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between}.modal-title[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#1f2937;margin:0}.btn-close[_ngcontent-%COMP%]{padding:6px;background:none;border:none;color:#6b7280;cursor:pointer;border-radius:6px;transition:all .2s}.btn-close[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.btn-close[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#1f2937}.modal-body[_ngcontent-%COMP%]{padding:24px}.modal-message[_ngcontent-%COMP%]{font-size:15px;color:#374151;line-height:1.6;margin:0}.modal-footer[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #e5e7eb;display:flex;gap:12px;justify-content:flex-end}.btn[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;border:none}.btn-cancel[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.btn-cancel[_ngcontent-%COMP%]:hover{background:#e5e7eb}.btn-confirm[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.btn-confirm[_ngcontent-%COMP%]:hover{background:#2563eb}.btn-confirm.btn-danger[_ngcontent-%COMP%]{background:#ef4444}.btn-confirm.btn-danger[_ngcontent-%COMP%]:hover{background:#dc2626}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scaleIn{0%{transform:scale(.95);opacity:0}to{transform:scale(1);opacity:1}}@media (max-width: 640px){.modal-dialog[_ngcontent-%COMP%]{margin:16px}.modal-header[_ngcontent-%COMP%], .modal-body[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]{padding:16px}}"]})};function ge(r,t){r&1&&(n(0,"div",9),f(1,"div",10),n(2,"p"),l(3,"Loading assignments..."),o()())}function pe(r,t){r&1&&(n(0,"div",11),_(),n(1,"svg",12),f(2,"path",4),o(),v(),n(3,"p",13),l(4,"No users assigned yet"),o(),n(5,"p",14),l(6,'Click "Assign Team" to add users to this maintenance schedule'),o()())}function ue(r,t){r&1&&(n(0,"span",38),_(),n(1,"svg",39),f(2,"path",40),o(),l(3," Completed "),o())}function fe(r,t){if(r&1){let e=C();n(0,"div",17)(1,"div",18)(2,"div",19),l(3),o(),n(4,"div",20)(5,"div",21),l(6),o(),n(7,"div",22),l(8),o()(),n(9,"button",23),m("click",function(){let a=g(e).$implicit,u=c(2);return p(u.onRemove(a))}),_(),n(10,"svg",3),f(11,"path",24),o()()(),v(),n(12,"div",25)(13,"div",26)(14,"span",27),l(15),o(),n(16,"span",28),l(17),o()(),n(18,"div",29)(19,"div",30)(20,"span",31),l(21,"Progress"),o(),n(22,"span",32),l(23),o()(),n(24,"div",33),f(25,"div",34),o(),n(26,"div",35)(27,"span",36),l(28),o(),x(29,ue,4,0,"span",37),o()()()()}if(r&2){let e=t.$implicit,i=c(2);s(3),b(" ",i.getUserInitials(e)," "),s(3),S(" ",e.user.first_name," ",e.user.last_name," "),s(2),h(e.user.email),s(6),d("ngClass",i.getRoleBadgeClass(e.user.user_type)),s(),b(" ",i.getRoleLabel(e.user.user_type)," "),s(2),b(" Assigned ",i.formatDate(e.created_at)," "),s(5),j("color",i.getProgressColor(e.completion_percentage)),s(),b(" ",e.completion_percentage,"% "),s(2),j("width",e.completion_percentage,"%")("background-color",i.getProgressColor(e.completion_percentage)),s(3),S(" ",e.completed_items," / ",e.total_items," items completed "),s(),d("ngIf",e.is_completed)}}function _e(r,t){if(r&1&&(n(0,"div",15),x(1,fe,30,17,"div",16),o()),r&2){let e=c();s(),d("ngForOf",e.assignments)}}var N=class r{assignments=[];loading=!1;removeAssignment=new M;showConfirmModal=!1;assignmentToRemove=null;userToRemoveName="";getUserInitials(t){let e=t.user.first_name?.charAt(0)||"",i=t.user.last_name?.charAt(0)||"";return(e+i).toUpperCase()}getRoleBadgeClass(t){return{admin:"badge-admin",manager:"badge-manager",team:"badge-team",owner:"badge-owner"}[t]||"badge-default"}getRoleLabel(t){return{admin:"Admin",manager:"Manager",team:"Team Member",owner:"Owner"}[t]||t}getProgressColor(t){return t===100?"#10b981":t>=50?"#3b82f6":t>0?"#f59e0b":"#9ca3af"}formatDate(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}onRemove(t){this.assignmentToRemove=t.id,this.userToRemoveName=`${t.user.first_name} ${t.user.last_name}`,this.showConfirmModal=!0}confirmRemoval(){this.assignmentToRemove!==null&&(this.removeAssignment.emit(this.assignmentToRemove),this.assignmentToRemove=null,this.userToRemoveName="")}cancelRemoval(){this.assignmentToRemove=null,this.userToRemoveName=""}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=y({type:r,selectors:[["app-assigned-users-list"]],inputs:{assignments:"assignments",loading:"loading"},outputs:{removeAssignment:"removeAssignment"},decls:10,vars:9,consts:[[1,"assigned-users"],[1,"section-header"],[1,"section-title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"],["class","loading-state",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","assignments-grid",4,"ngIf"],[3,"isOpenChange","confirmed","cancelled","isOpen","title","message","confirmText","isDanger"],[1,"loading-state"],[1,"spinner"],[1,"empty-state"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"empty-icon"],[1,"empty-text"],[1,"empty-subtext"],[1,"assignments-grid"],["class","assignment-card",4,"ngFor","ngForOf"],[1,"assignment-card"],[1,"card-header"],[1,"user-avatar"],[1,"user-info"],[1,"user-name"],[1,"user-email"],["title","Remove assignment",1,"btn-remove",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"card-body"],[1,"info-row"],[1,"role-badge",3,"ngClass"],[1,"assigned-date"],[1,"progress-section"],[1,"progress-header"],[1,"progress-label"],[1,"progress-percentage"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-details"],[1,"items-count"],["class","completed-badge",4,"ngIf"],[1,"completed-badge"],["fill","currentColor","viewBox","0 0 20 20"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"h3",2),_(),n(3,"svg",3),f(4,"path",4),o(),l(5),o()(),x(6,ge,4,0,"div",5)(7,pe,7,0,"div",6)(8,_e,2,1,"div",7),o(),v(),n(9,"app-confirmation-modal",8),A("isOpenChange",function(u){return T(i.showConfirmModal,u)||(i.showConfirmModal=u),u}),m("confirmed",function(){return i.confirmRemoval()})("cancelled",function(){return i.cancelRemoval()}),o()),e&2&&(s(5),b(" Assigned Team (",i.assignments.length,") "),s(),d("ngIf",i.loading),s(),d("ngIf",!i.loading&&i.assignments.length===0),s(),d("ngIf",!i.loading&&i.assignments.length>0),s(),k("isOpen",i.showConfirmModal),d("title","Remove Assignment")("message","Are you sure you want to remove "+i.userToRemoveName+" from this maintenance schedule?")("confirmText","Remove")("isDanger",!0))},dependencies:[P,D,V,O,R],styles:[".assigned-users[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:24px;box-shadow:0 1px 3px #0000001a}.section-header[_ngcontent-%COMP%]{margin-bottom:20px}.section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;font-size:18px;font-weight:700;color:#1f2937;margin:0}.section-title[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:22px;height:22px;color:#3b82f6}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#6b7280}.loading-state[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid #e5e7eb;border-top-color:#3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin:0 auto 16px}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#6b7280}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{width:64px;height:64px;color:#d1d5db;margin:0 auto 16px}.empty-state[_ngcontent-%COMP%]   .empty-text[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#374151;margin:0 0 8px}.empty-state[_ngcontent-%COMP%]   .empty-subtext[_ngcontent-%COMP%]{font-size:14px;margin:0}.assignments-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px}.assignment-card[_ngcontent-%COMP%]{border:2px solid #e5e7eb;border-radius:10px;overflow:hidden;transition:all .2s}.assignment-card[_ngcontent-%COMP%]:hover{border-color:#d1d5db;box-shadow:0 4px 6px -1px #0000001a}.card-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px;background:#f9fafb;border-bottom:1px solid #e5e7eb}.user-avatar[_ngcontent-%COMP%]{flex-shrink:0;width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:15px}.user-info[_ngcontent-%COMP%]{flex:1;min-width:0}.user-name[_ngcontent-%COMP%]{font-size:15px;font-weight:600;color:#1f2937;margin-bottom:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.user-email[_ngcontent-%COMP%]{font-size:13px;color:#6b7280;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.btn-remove[_ngcontent-%COMP%]{flex-shrink:0;padding:8px;background:none;border:none;color:#9ca3af;cursor:pointer;border-radius:6px;transition:all .2s}.btn-remove[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:18px;height:18px}.btn-remove[_ngcontent-%COMP%]:hover{background:#fee2e2;color:#dc2626}.card-body[_ngcontent-%COMP%]{padding:16px}.info-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:8px}.role-badge[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;white-space:nowrap}.role-badge.badge-admin[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.role-badge.badge-manager[_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.role-badge.badge-team[_ngcontent-%COMP%]{background:#d1fae5;color:#065f46}.role-badge.badge-owner[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.role-badge.badge-default[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.assigned-date[_ngcontent-%COMP%]{font-size:12px;color:#9ca3af;white-space:nowrap}.progress-section[_ngcontent-%COMP%]{margin-top:12px}.progress-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.progress-label[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:#6b7280}.progress-percentage[_ngcontent-%COMP%]{font-size:14px;font-weight:700}.progress-bar[_ngcontent-%COMP%]{height:8px;background:#e5e7eb;border-radius:4px;overflow:hidden;margin-bottom:8px}.progress-fill[_ngcontent-%COMP%]{height:100%;transition:width .3s ease,background-color .3s ease}.progress-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px}.items-count[_ngcontent-%COMP%]{font-size:12px;color:#6b7280}.completed-badge[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:3px 8px;background:#d1fae5;color:#065f46;border-radius:10px;font-size:11px;font-weight:600}.completed-badge[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:14px;height:14px}@media (max-width: 768px){.assignments-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.assigned-users[_ngcontent-%COMP%]{padding:16px}.card-header[_ngcontent-%COMP%], .card-body[_ngcontent-%COMP%]{padding:12px}.user-avatar[_ngcontent-%COMP%]{width:40px;height:40px;font-size:14px}}"]})};function xe(r,t){if(r&1){let e=C();n(0,"button",20),m("click",function(){g(e);let a=c();return p(a.openAssignDialog())}),_(),n(1,"svg",5),f(2,"path",21),o(),v(),n(3,"span"),l(4,"Assign Team"),o()()}}function he(r,t){r&1&&(n(0,"div",16),l(1,"Loading..."),o())}function ve(r,t){if(r&1&&(n(0,"div",17),l(1),o()),r&2){let e=c();s(),h(e.error)}}function be(r,t){if(r&1){let e=C();n(0,"div",18)(1,"div",22)(2,"div",23)(3,"div")(4,"div",24),l(5,"Maintenance Schedule"),o(),n(6,"h1",25),l(7),o()(),n(8,"span",26),l(9),o()(),n(10,"div",27)(11,"div")(12,"div",28),l(13,"Start"),o(),n(14,"div",7),l(15),o()(),n(16,"div")(17,"div",28),l(18,"Due"),o(),n(19,"div",7),l(20),o()(),n(21,"div")(22,"div",28),l(23,"Priority"),o(),n(24,"div",7),l(25),o()(),n(26,"div")(27,"div",28),l(28,"Assets"),o(),n(29,"div",7),l(30),o()()()(),n(31,"app-assigned-users-list",29),m("removeAssignment",function(a){g(e);let u=c();return p(u.onRemoveAssignment(a))}),o()()}if(r&2){let e=c();s(7),S("#",e.schedule==null?null:e.schedule.id," \u2022 ",(e.schedule==null?null:e.schedule.plan_name)||"Plan "+(e.schedule==null?null:e.schedule.maintenance_plan_id),""),s(2),h(e.getStatusName(e.schedule==null?null:e.schedule.status)||"Scheduled"),s(6),h(e.formatDate(e.schedule==null?null:e.schedule.start_date)),s(5),h(e.formatDate(e.schedule==null?null:e.schedule.due_date)),s(5),h((e.schedule==null||e.schedule.priority==null?null:e.schedule.priority.name)||"-"),s(5),h(e.getAssetNames()||"-"),s(),d("assignments",e.assignments)("loading",e.assignmentsLoading)}}var Z=class r{constructor(t,e,i,a,u){this.route=t;this.router=e;this.api=i;this.authService=a;this.toastService=u}loading=!1;error=null;schedule=null;assignments=[];assignmentsLoading=!1;isAssignDialogOpen=!1;scheduleId=0;ngOnInit(){let t=Number(this.route.snapshot.paramMap.get("id"));if(!t){this.error="Invalid schedule id";return}this.scheduleId=t,this.fetch(t),this.loadAssignments(t)}fetch(t){this.loading=!0,this.error=null,this.api.getSchedule(t).subscribe({next:e=>{let i=e?.data?.schedule||e?.data||e;i&&i.id?this.schedule=G({},i):this.error="Schedule not found",this.loading=!1},error:e=>{console.error("Error loading schedule:",e),this.loading=!1,this.error="Failed to load schedule"}})}loadAssignments(t){this.assignmentsLoading=!0,this.api.getScheduleAssignments(t).subscribe({next:e=>{this.assignments=e.data,this.assignmentsLoading=!1},error:e=>{console.error("Error loading assignments:",e),this.assignmentsLoading=!1}})}openAssignDialog(){this.isAssignDialogOpen=!0}onAssigned(){this.loadAssignments(this.scheduleId)}onRemoveAssignment(t){this.api.removeAssignment(t).subscribe({next:()=>{this.toastService.success("Assignment removed successfully"),this.loadAssignments(this.scheduleId)},error:e=>{console.error("Error removing assignment:",e),this.toastService.error("Failed to remove assignment. Please try again.")}})}canManageAssignments(){let t=this.authService.getCurrentUser();if(!t)return!1;let e=t.user_type?.toLowerCase();return e==="admin"||e==="manager"||e==="owner"}formatDate(t){if(!t)return"-";let e=new Date(t);return isNaN(e.getTime())?"-":e.toLocaleString()}getStatusName(t){if(!t)return"Scheduled";switch(t){case"in_progress":return"In Progress";case"overdue":return"Overdue";case"completed":return"Completed";case"scheduled":return"Scheduled";default:return t.charAt(0).toUpperCase()+t.slice(1).replace("_"," ")}}getAssetNames(){return this.schedule?this.schedule.assets&&Array.isArray(this.schedule.assets)&&this.schedule.assets.length>0?this.schedule.assets.map(t=>t.name).join(", "):this.schedule.asset_ids&&Array.isArray(this.schedule.asset_ids)?this.schedule.asset_ids.join(", "):"-":"-"}goBack(){this.router.navigate(["/maintenance/scheduled"])}static \u0275fac=function(e){return new(e||r)(w($),w(Q),w(L),w(K),w(U))};static \u0275cmp=y({type:r,selectors:[["app-schedule-preview-page"]],decls:25,vars:6,consts:[[1,""],[1,"bg-white","border-b","border-gray-200","px-6","py-4","print-hide"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-4"],[1,"flex","items-center","space-x-2","text-gray-600","hover:text-gray-800","transition-colors","p-2","-ml-2","rounded-lg","hover:bg-gray-50",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"font-medium"],["aria-label","Breadcrumb",1,"flex"],[1,"flex","items-center","space-x-2"],["href","javascript:void(0)",1,"text-gray-500","hover:text-gray-700","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-gray-400","mx-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"text-gray-900","font-medium"],["class","flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium",3,"click",4,"ngIf"],[1,"min-h-screen","bg-gray-50","p-6"],[1,"text-center","py-20"],[1,"text-center","text-red-600","py-20"],[1,"max-w-3xl","mx-auto","space-y-6"],[3,"isOpenChange","assigned","scheduleId","isOpen"],[1,"flex","items-center","space-x-2","bg-blue-600","text-white","px-4","py-2","rounded-lg","hover:bg-blue-700","transition-colors","font-medium",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"],[1,"bg-white","border","border-gray-200","rounded-2xl","shadow-sm","p-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-sm","text-gray-500"],[1,"text-2xl","font-semibold"],[1,"bg-gray-100","text-gray-700","text-xs","font-semibold","px-3","py-1","rounded-full"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"text-sm","text-gray-600"],[3,"removeAssignment","assignments","loading"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),m("click",function(){return i.goBack()}),_(),n(5,"svg",5),f(6,"path",6),o(),v(),n(7,"span",7),l(8,"Back"),o()(),n(9,"nav",8)(10,"ol",9)(11,"li")(12,"a",10),m("click",function(){return i.goBack()}),l(13,"Maintenance Schedule"),o()(),n(14,"li"),_(),n(15,"svg",11),f(16,"path",12),o()(),v(),n(17,"li",13),l(18,"Schedule Details"),o()()()(),x(19,xe,5,0,"button",14),o()(),n(20,"div",15),x(21,he,2,0,"div",16)(22,ve,2,1,"div",17)(23,be,32,9,"div",18),o()(),n(24,"app-assign-team-dialog",19),A("isOpenChange",function(u){return T(i.isAssignDialogOpen,u)||(i.isAssignDialogOpen=u),u}),m("assigned",function(){return i.onAssigned()}),o()),e&2&&(s(19),d("ngIf",i.canManageAssignments()&&!i.loading&&!i.error),s(2),E(i.loading?21:-1),s(),E(i.error?22:-1),s(),E(!i.loading&&!i.error&&i.schedule?23:-1),s(),d("scheduleId",i.scheduleId),k("isOpen",i.isAssignDialogOpen))},dependencies:[P,O,z,N],styles:[".btn.btn-secondary[_ngcontent-%COMP%]{background:#fff;color:#374151;border:1px solid #d1d5db;padding:.5rem 1rem;border-radius:.5rem}.btn.btn-secondary[_ngcontent-%COMP%]:hover{background:#f9fafb}"]})};export{Z as SchedulePreviewPageComponent};
