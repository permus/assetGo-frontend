import{a as l}from"./chunk-MPFP4EBB.js";import{D as u}from"./chunk-AM36OUCP.js";import{S as r,V as a,_ as p,g as o}from"./chunk-22ONQWC6.js";import{a as n}from"./chunk-EQDQRRRY.js";var h=class s{constructor(e){this.http=e;this.loadUserFromStorage()}apiUrl=l.apiUrl;currentUserSubject=new o(null);currentUser$=this.currentUserSubject.asObservable();getAuthHeaders(){let e=this.getToken();return{headers:n({"Content-Type":"application/json"},e?{Authorization:`Bearer ${e}`}:{})}}register(e){return this.http.post(`${this.apiUrl}/register`,e,this.getAuthHeaders())}login(e){return this.http.post(`${this.apiUrl}/login`,e,{headers:{"Content-Type":"application/json"}}).pipe(r(t=>{t.success&&t.data?.token&&this.setSession(t.data.token,t.data.user)}))}forgotPassword(e){return this.http.post(`${this.apiUrl}/forgot-password`,e,this.getAuthHeaders())}resetPassword(e){return this.http.post(`${this.apiUrl}/reset-password`,e,this.getAuthHeaders())}verifyEmail(e,t){return this.http.get(`${this.apiUrl}/email/verify/${e}/${t}`,this.getAuthHeaders())}resendVerification(e){return this.http.post(`${this.apiUrl}/email/resend`,e||{},this.getAuthHeaders())}getProfile(){return this.http.get(`${this.apiUrl}/profile`,this.getAuthHeaders())}logout(){return this.http.post(`${this.apiUrl}/logout`,{},this.getAuthHeaders()).pipe(r(()=>{this.clearSession()}))}logoutAll(){return this.http.post(`${this.apiUrl}/logout-all`,{}).pipe(r(()=>{this.clearSession()}))}isAuthenticated(){return!!localStorage.getItem("token")}getToken(){return localStorage.getItem("token")}getCurrentUser(){return this.currentUserSubject.value}setSession(e,t){localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t)),this.currentUserSubject.next(t)}clearSession(){localStorage.removeItem("token"),localStorage.removeItem("user"),this.currentUserSubject.next(null)}loadUserFromStorage(){let e=localStorage.getItem("token"),t=localStorage.getItem("user");if(e&&t)try{let i=JSON.parse(t);this.currentUserSubject.next(i)}catch{this.clearSession()}}static \u0275fac=function(t){return new(t||s)(p(u))};static \u0275prov=a({token:s,factory:s.\u0275fac,providedIn:"root"})};export{h as a};
