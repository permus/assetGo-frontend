{
  "version": 3,
  "sources": ["src/app/core/services/preferences.service.ts"],
  "sourcesContent": ["import { Injectable, inject } from '@angular/core';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { environment } from '../../../environments/environment';\r\n\r\nexport interface UserPreferences {\r\n  // Localization\r\n  language?: string;\r\n  rtl?: boolean;\r\n  date_format?: string;\r\n  time_format?: string;\r\n  number_format?: string;\r\n  timezone?: string;\r\n  \r\n  // Notifications\r\n  email_notifications?: boolean;\r\n  push_notifications?: boolean;\r\n  maintenance_alerts?: boolean;\r\n  work_order_updates?: boolean;\r\n  \r\n  // Display\r\n  dashboard_layout?: 'grid' | 'list';\r\n  items_per_page?: number;\r\n  auto_refresh?: boolean;\r\n  compact_view?: boolean;\r\n  show_avatars?: boolean;\r\n  \r\n  // Accessibility\r\n  dark_mode?: boolean;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PreferencesService {\r\n  private http = inject(HttpClient);\r\n  private apiUrl = environment.apiUrl;\r\n  \r\n  private preferencesSubject = new BehaviorSubject<UserPreferences>({\r\n    // Defaults\r\n    email_notifications: true,\r\n    push_notifications: true,\r\n    maintenance_alerts: true,\r\n    work_order_updates: true,\r\n    dashboard_layout: 'grid',\r\n    items_per_page: 20,\r\n    auto_refresh: false,\r\n    compact_view: false,\r\n    show_avatars: true,\r\n    dark_mode: false,\r\n  });\r\n\r\n  public preferences$: Observable<UserPreferences> = this.preferencesSubject.asObservable();\r\n\r\n  constructor() {\r\n    this.loadPreferences();\r\n  }\r\n\r\n  /**\r\n   * Load preferences from localStorage and apply to app\r\n   */\r\n  private loadPreferences(): void {\r\n    const stored = localStorage.getItem('app.preferences');\r\n    if (stored) {\r\n      try {\r\n        const prefs = JSON.parse(stored);\r\n        this.preferencesSubject.next({ ...this.preferencesSubject.value, ...prefs });\r\n        this.applyPreferences(prefs);\r\n      } catch (error) {\r\n        console.error('Failed to load preferences:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current preferences\r\n   */\r\n  getPreferences(): UserPreferences {\r\n    return this.preferencesSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Update preferences\r\n   */\r\n  updatePreferences(prefs: Partial<UserPreferences>): void {\r\n    const updated = { ...this.preferencesSubject.value, ...prefs };\r\n    this.preferencesSubject.next(updated);\r\n    localStorage.setItem('app.preferences', JSON.stringify(updated));\r\n    this.applyPreferences(updated);\r\n  }\r\n\r\n  /**\r\n   * Apply preferences to the application\r\n   */\r\n  private applyPreferences(prefs: UserPreferences): void {\r\n    // Apply dark mode\r\n    if (prefs.dark_mode) {\r\n      document.documentElement.classList.add('dark');\r\n    } else {\r\n      document.documentElement.classList.remove('dark');\r\n    }\r\n\r\n    // Apply compact view\r\n    if (prefs.compact_view) {\r\n      document.documentElement.classList.add('compact-mode');\r\n    } else {\r\n      document.documentElement.classList.remove('compact-mode');\r\n    }\r\n\r\n    // Apply RTL\r\n    if (prefs.rtl) {\r\n      document.documentElement.setAttribute('dir', 'rtl');\r\n    } else {\r\n      document.documentElement.setAttribute('dir', 'ltr');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get specific preference value\r\n   */\r\n  get<K extends keyof UserPreferences>(key: K): UserPreferences[K] {\r\n    return this.preferencesSubject.value[key];\r\n  }\r\n\r\n  /**\r\n   * Set specific preference value\r\n   */\r\n  set<K extends keyof UserPreferences>(key: K, value: UserPreferences[K]): void {\r\n    const updated = { ...this.preferencesSubject.value, [key]: value };\r\n    this.updatePreferences(updated);\r\n  }\r\n\r\n  private syncing = false;\r\n\r\n  /**\r\n   * Sync preferences from backend\r\n   */\r\n  syncFromBackend(): Observable<any> {\r\n    // Prevent multiple simultaneous requests\r\n    if (this.syncing) {\r\n      return new Observable(observer => {\r\n        observer.next({ success: true, data: this.preferencesSubject.value });\r\n        observer.complete();\r\n      });\r\n    }\r\n\r\n    this.syncing = true;\r\n    return this.http.get(`${this.apiUrl}/settings/preferences`).pipe(\r\n      tap(() => {\r\n        this.syncing = false;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Save preferences to backend\r\n   */\r\n  saveToBackend(prefs: UserPreferences): Observable<any> {\r\n    return this.http.put(`${this.apiUrl}/settings/preferences`, prefs);\r\n  }\r\n}\r\n\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;AAmCM,IAAO,qBAAP,MAAO,oBAAkB;EACrB,OAAO,OAAO,UAAU;EACxB,SAAS,YAAY;EAErB,qBAAqB,IAAI,gBAAiC;;IAEhE,qBAAqB;IACrB,oBAAoB;IACpB,oBAAoB;IACpB,oBAAoB;IACpB,kBAAkB;IAClB,gBAAgB;IAChB,cAAc;IACd,cAAc;IACd,cAAc;IACd,WAAW;GACZ;EAEM,eAA4C,KAAK,mBAAmB,aAAY;EAEvF,cAAA;AACE,SAAK,gBAAe;EACtB;;;;EAKQ,kBAAe;AACrB,UAAM,SAAS,aAAa,QAAQ,iBAAiB;AACrD,QAAI,QAAQ;AACV,UAAI;AACF,cAAM,QAAQ,KAAK,MAAM,MAAM;AAC/B,aAAK,mBAAmB,KAAK,kCAAK,KAAK,mBAAmB,QAAU,MAAO;AAC3E,aAAK,iBAAiB,KAAK;MAC7B,SAAS,OAAO;AACd,gBAAQ,MAAM,+BAA+B,KAAK;MACpD;IACF;EACF;;;;EAKA,iBAAc;AACZ,WAAO,KAAK,mBAAmB;EACjC;;;;EAKA,kBAAkB,OAA+B;AAC/C,UAAM,UAAU,kCAAK,KAAK,mBAAmB,QAAU;AACvD,SAAK,mBAAmB,KAAK,OAAO;AACpC,iBAAa,QAAQ,mBAAmB,KAAK,UAAU,OAAO,CAAC;AAC/D,SAAK,iBAAiB,OAAO;EAC/B;;;;EAKQ,iBAAiB,OAAsB;AAE7C,QAAI,MAAM,WAAW;AACnB,eAAS,gBAAgB,UAAU,IAAI,MAAM;IAC/C,OAAO;AACL,eAAS,gBAAgB,UAAU,OAAO,MAAM;IAClD;AAGA,QAAI,MAAM,cAAc;AACtB,eAAS,gBAAgB,UAAU,IAAI,cAAc;IACvD,OAAO;AACL,eAAS,gBAAgB,UAAU,OAAO,cAAc;IAC1D;AAGA,QAAI,MAAM,KAAK;AACb,eAAS,gBAAgB,aAAa,OAAO,KAAK;IACpD,OAAO;AACL,eAAS,gBAAgB,aAAa,OAAO,KAAK;IACpD;EACF;;;;EAKA,IAAqC,KAAM;AACzC,WAAO,KAAK,mBAAmB,MAAM,GAAG;EAC1C;;;;EAKA,IAAqC,KAAQ,OAAyB;AACpE,UAAM,UAAU,iCAAK,KAAK,mBAAmB,QAA7B,EAAoC,CAAC,GAAG,GAAG,MAAK;AAChE,SAAK,kBAAkB,OAAO;EAChC;EAEQ,UAAU;;;;EAKlB,kBAAe;AAEb,QAAI,KAAK,SAAS;AAChB,aAAO,IAAI,WAAW,cAAW;AAC/B,iBAAS,KAAK,EAAE,SAAS,MAAM,MAAM,KAAK,mBAAmB,MAAK,CAAE;AACpE,iBAAS,SAAQ;MACnB,CAAC;IACH;AAEA,SAAK,UAAU;AACf,WAAO,KAAK,KAAK,IAAI,GAAG,KAAK,MAAM,uBAAuB,EAAE,KAC1D,IAAI,MAAK;AACP,WAAK,UAAU;IACjB,CAAC,CAAC;EAEN;;;;EAKA,cAAc,OAAsB;AAClC,WAAO,KAAK,KAAK,IAAI,GAAG,KAAK,MAAM,yBAAyB,KAAK;EACnE;;qCA7HW,qBAAkB;EAAA;4EAAlB,qBAAkB,SAAlB,oBAAkB,WAAA,YAFjB,OAAM,CAAA;;;sEAEP,oBAAkB,CAAA;UAH9B;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
