import{x as R}from"./chunk-6FWKCNZ5.js";import{D as w,k as E,l as O,v as P}from"./chunk-42X3OFWX.js";import{Bb as u,Cb as g,Ha as y,Ka as l,Pa as C,Pb as r,Qb as p,Rb as v,V as _,Ya as M,_ as b,bb as d,ga as I,ha as h,ib as s,sb as n,tb as i,ub as A,yb as S}from"./chunk-MPDVOBHD.js";import{f as m}from"./chunk-EQDQRRRY.js";var f=class o{constructor(e){this.http=e}MAX_SIZE=10*1024*1024;ALLOWED=["image/png","image/jpeg","image/jpg"];validate(e){return this.ALLOWED.includes(e.type)?e.size>this.MAX_SIZE?{ok:!1,reason:"File exceeds 10MB"}:{ok:!0}:{ok:!1,reason:"Only PNG/JPG allowed"}}toDataUrl(e){return m(this,null,function*(){let t=yield e.arrayBuffer(),a=btoa(String.fromCharCode(...new Uint8Array(t)));return`data:image/${e.type==="image/png"?"png":"jpeg"};base64,${a}`})}analyze(e){return this.http.post("/api/ai/image-recognition/analyze",{images:e})}static \u0275fac=function(t){return new(t||o)(b(w))};static \u0275prov=_({token:o,factory:o.\u0275fac,providedIn:"root"})};function T(o,e){if(o&1){let t=S();n(0,"div",10),A(1,"img",11),n(2,"button",12),u("click",function(){let c=I(t).index,x=g(2);return h(x.remove(c))}),r(3,"Remove"),i()()}if(o&2){let t=e.$implicit,a=e.index;l(),s("src",t,y)("alt","preview-"+a)}}function j(o,e){if(o&1&&(n(0,"div",8),d(1,T,4,2,"div",9),i()),o&2){let t=g();l(),s("ngForOf",t.previews)}}function D(o,e){if(o&1&&(n(0,"p",13),r(1),i()),o&2){let t=g();l(),p(t.errorMsg)}}function N(o,e){if(o&1&&(n(0,"li"),r(1),i()),o&2){let t=e.$implicit;l(),p(t)}}function U(o,e){if(o&1&&(n(0,"section",14)(1,"div",15)(2,"div")(3,"div",16),r(4,"Asset Type"),i(),n(5,"div",17),r(6),i()(),n(7,"div",18),r(8),i()(),n(9,"div",19)(10,"div")(11,"span"),r(12,"Manufacturer"),i(),n(13,"strong"),r(14),i()(),n(15,"div")(16,"span"),r(17,"Model"),i(),n(18,"strong"),r(19),i()(),n(20,"div")(21,"span"),r(22,"Serial"),i(),n(23,"strong"),r(24),i()(),n(25,"div")(26,"span"),r(27,"Condition"),i(),n(28,"strong"),r(29),i()()(),n(30,"div",20)(31,"div",16),r(32,"Recommendations"),i(),n(33,"ul"),d(34,N,2,1,"li",21),i()(),n(35,"div",22)(36,"button"),r(37,"Generate QR"),i(),n(38,"button",23),r(39,"Create Asset Record"),i()()()),o&2){let t=g();l(6),p(t.result.assetType),l(2),v("Confidence ",t.result.confidence,"%"),l(6),p(t.result.manufacturer||"\u2014"),l(5),p(t.result.model||"\u2014"),l(5),p(t.result.serialNumber||"\u2014"),l(5),p(t.result.condition),l(5),s("ngForOf",t.result.recommendations)}}var z=class o{constructor(e){this.up=e}files=[];previews=[];isAnalyzing=!1;result=null;errorMsg="";onSelect(e){return m(this,null,function*(){let t=e.target;if(t.files?.length)for(let a of Array.from(t.files)){let c=this.up.validate(a);if(!c.ok){this.errorMsg=c.reason||"Invalid file";continue}this.files.push(a),this.previews.push(yield this.up.toDataUrl(a))}})}analyze(){return m(this,null,function*(){this.previews.length!==0&&(this.isAnalyzing=!0,this.errorMsg="",this.result=null,this.up.analyze(this.previews).subscribe({next:e=>{this.result=e.data,this.isAnalyzing=!1},error:e=>{this.errorMsg=e?.error?.message||"Analysis failed",this.isAnalyzing=!1}}))})}remove(e){this.files.splice(e,1),this.previews.splice(e,1)}static \u0275fac=function(t){return new(t||o)(C(f))};static \u0275cmp=M({type:o,selectors:[["app-ai-image-recognition"]],decls:12,vars:5,consts:[[1,"container"],[1,"uploader"],["type","file","multiple","","accept","image/png,image/jpeg",3,"change"],[1,"hint"],["class","previews",4,"ngIf"],[3,"click","disabled"],["class","error",4,"ngIf"],["class","result",4,"ngIf"],[1,"previews"],["class","thumb",4,"ngFor","ngForOf"],[1,"thumb"],[3,"src","alt"],[3,"click"],[1,"error"],[1,"result"],[1,"header"],[1,"label"],[1,"value"],[1,"chip"],[1,"grid"],[1,"recs"],[4,"ngFor","ngForOf"],[1,"actions"],[1,"primary"]],template:function(t,a){t&1&&(n(0,"div",0)(1,"h2"),r(2,"AI Image Recognition"),i(),n(3,"div",1)(4,"input",2),u("change",function(x){return a.onSelect(x)}),i(),n(5,"p",3),r(6,"PNG/JPG up to 10MB. Add 1\u20135 images. Include nameplate close-ups."),i()(),d(7,j,2,1,"div",4),n(8,"button",5),u("click",function(){return a.analyze()}),r(9),i(),d(10,D,2,1,"p",6)(11,U,40,7,"section",7),i()),t&2&&(l(7),s("ngIf",a.previews.length),l(),s("disabled",a.isAnalyzing||!a.previews.length),l(),v(" ",a.isAnalyzing?"Analyzing\u2026":"Analyze Image"," "),l(),s("ngIf",a.errorMsg),l(),s("ngIf",a.result))},dependencies:[P,E,O,R],styles:[".container[_ngcontent-%COMP%]{max-width:960px;margin:20px auto;padding:16px}.uploader[_ngcontent-%COMP%]{border:2px dashed #d1d5db;padding:24px;border-radius:12px;text-align:center}.hint[_ngcontent-%COMP%]{color:#6b7280;margin-top:8px}.previews[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;margin-top:16px}.thumb[_ngcontent-%COMP%]{position:relative;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden}.thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:140px;object-fit:cover;display:block}.thumb[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:absolute;top:6px;right:6px}button[_ngcontent-%COMP%]{margin-top:16px;padding:10px 16px;border-radius:8px;border:1px solid rgba(17,24,39,.1333333333);background:#111827;color:#fff}button[disabled][_ngcontent-%COMP%]{opacity:.6}.error[_ngcontent-%COMP%]{color:#b91c1c;margin-top:8px}.result[_ngcontent-%COMP%]{margin-top:24px;border:1px solid #e5e7eb;border-radius:12px;padding:16px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.label[_ngcontent-%COMP%]{color:#6b7280;font-size:12px}.value[_ngcontent-%COMP%]{font-weight:600;font-size:18px}.chip[_ngcontent-%COMP%]{background:#d1fae5;color:#065f46;padding:6px 10px;border-radius:999px;font-size:12px}.grid[_ngcontent-%COMP%]{margin-top:12px;display:grid;grid-template-columns:repeat(2,1fr);gap:10px}.recs[_ngcontent-%COMP%]{margin-top:12px}.actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:12px}.actions[_ngcontent-%COMP%]   .primary[_ngcontent-%COMP%]{background:#2563eb}"]})};export{z as AIImageRecognitionComponent};
